/*! onion-editor 2015-03-05 */
!function(a,b){"function"==typeof define?define(b):"object"==typeof exports?module.exports=b():a.OnionEditor=b()}(this,function(){var a,b,c;return function(d){function e(a,b){return u.call(a,b)}function f(a,b){var c,d,e,f,g,h,i,j,k,l,m,n=b&&b.split("/"),o=s.map,p=o&&o["*"]||{};if(a&&"."===a.charAt(0))if(b){for(n=n.slice(0,n.length-1),a=a.split("/"),g=a.length-1,s.nodeIdCompat&&w.test(a[g])&&(a[g]=a[g].replace(w,"")),a=n.concat(a),k=0;k<a.length;k+=1)if(m=a[k],"."===m)a.splice(k,1),k-=1;else if(".."===m){if(1===k&&(".."===a[2]||".."===a[0]))break;k>0&&(a.splice(k-1,2),k-=2)}a=a.join("/")}else 0===a.indexOf("./")&&(a=a.substring(2));if((n||p)&&o){for(c=a.split("/"),k=c.length;k>0;k-=1){if(d=c.slice(0,k).join("/"),n)for(l=n.length;l>0;l-=1)if(e=o[n.slice(0,l).join("/")],e&&(e=e[d])){f=e,h=k;break}if(f)break;!i&&p&&p[d]&&(i=p[d],j=k)}!f&&i&&(f=i,h=j),f&&(c.splice(0,h,f),a=c.join("/"))}return a}function g(a,b){return function(){return n.apply(d,v.call(arguments,0).concat([a,b]))}}function h(a){return function(b){return f(b,a)}}function i(a){return function(b){q[a]=b}}function j(a){if(e(r,a)){var b=r[a];delete r[a],t[a]=!0,m.apply(d,b)}if(!e(q,a)&&!e(t,a))throw new Error("No "+a);return q[a]}function k(a){var b,c=a?a.indexOf("!"):-1;return c>-1&&(b=a.substring(0,c),a=a.substring(c+1,a.length)),[b,a]}function l(a){return function(){return s&&s.config&&s.config[a]||{}}}var m,n,o,p,q={},r={},s={},t={},u=Object.prototype.hasOwnProperty,v=[].slice,w=/\.js$/;o=function(a,b){var c,d=k(a),e=d[0];return a=d[1],e&&(e=f(e,b),c=j(e)),e?a=c&&c.normalize?c.normalize(a,h(b)):f(a,b):(a=f(a,b),d=k(a),e=d[0],a=d[1],e&&(c=j(e))),{f:e?e+"!"+a:a,n:a,pr:e,p:c}},p={require:function(a){return g(a)},exports:function(a){var b=q[a];return"undefined"!=typeof b?b:q[a]={}},module:function(a){return{id:a,uri:"",exports:q[a],config:l(a)}}},m=function(a,b,c,f){var h,k,l,m,n,s,u=[],v=typeof c;if(f=f||a,"undefined"===v||"function"===v){for(b=!b.length&&c.length?["require","exports","module"]:b,n=0;n<b.length;n+=1)if(m=o(b[n],f),k=m.f,"require"===k)u[n]=p.require(a);else if("exports"===k)u[n]=p.exports(a),s=!0;else if("module"===k)h=u[n]=p.module(a);else if(e(q,k)||e(r,k)||e(t,k))u[n]=j(k);else{if(!m.p)throw new Error(a+" missing "+k);m.p.load(m.n,g(f,!0),i(k),{}),u[n]=q[k]}l=c?c.apply(q[a],u):void 0,a&&(h&&h.exports!==d&&h.exports!==q[a]?q[a]=h.exports:l===d&&s||(q[a]=l))}else a&&(q[a]=c)},a=b=n=function(a,b,c,e,f){if("string"==typeof a)return p[a]?p[a](b):j(o(a,b).f);if(!a.splice){if(s=a,s.deps&&n(s.deps,s.callback),!b)return;b.splice?(a=b,b=c,c=null):a=d}return b=b||function(){},"function"==typeof c&&(c=e,e=f),e?m(d,a,b,c):setTimeout(function(){m(d,a,b,c)},4),n},n.config=function(a){return n(a)},a._defined=q,c=function(a,b,c){b.splice||(c=b,b=[]),e(q,a)||e(r,a)||(r[a]=[a,b,c])},c.amd={jQuery:!0}}(),c("../../bower_components/almond/almond",function(){}),c("lodash-amd/modern/internals/isNative",[],function(){function a(a){return"function"==typeof a&&d.test(a)}var b=Object.prototype,c=b.toString,d=RegExp("^"+String(c).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$");return a}),c("lodash-amd/modern/internals/objectTypes",[],function(){var a={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1};return a}),c("lodash-amd/modern/objects/isObject",["../internals/objectTypes"],function(a){function b(b){return!(!b||!a[typeof b])}return b}),c("lodash-amd/modern/internals/shimKeys",["./objectTypes"],function(a){var b=Object.prototype,c=b.hasOwnProperty,d=function(b){var d,e=b,f=[];if(!e)return f;if(!a[typeof b])return f;for(d in e)c.call(e,d)&&f.push(d);return f};return d}),c("lodash-amd/modern/objects/keys",["../internals/isNative","./isObject","../internals/shimKeys"],function(a,b,c){var d=a(d=Object.keys)&&d,e=d?function(a){return b(a)?d(a):[]}:c;return e}),c("lodash-amd/modern/objects/defaults",["./keys","../internals/objectTypes"],function(a,b){var c=function(c,d,e){var f,g=c,h=g;if(!g)return h;for(var i=arguments,j=0,k="number"==typeof e?2:i.length;++j<k;)if(g=i[j],g&&b[typeof g])for(var l=-1,m=b[typeof g]&&a(g),n=m?m.length:0;++l<n;)f=m[l],"undefined"==typeof h[f]&&(h[f]=g[f]);return h};return c}),c("lodash-amd/modern/objects/isArguments",[],function(){function a(a){return a&&"object"==typeof a&&"number"==typeof a.length&&d.call(a)==b||!1}var b="[object Arguments]",c=Object.prototype,d=c.toString;return a}),c("lodash-amd/modern/objects/isArray",["../internals/isNative"],function(a){var b="[object Array]",c=Object.prototype,d=c.toString,e=a(e=Array.isArray)&&e,f=e||function(a){return a&&"object"==typeof a&&"number"==typeof a.length&&d.call(a)==b||!1};return f}),c("lodash-amd/modern/internals/baseFlatten",["../objects/isArguments","../objects/isArray"],function(a,b){function c(d,e,f,g){for(var h=(g||0)-1,i=d?d.length:0,j=[];++h<i;){var k=d[h];if(k&&"object"==typeof k&&"number"==typeof k.length&&(b(k)||a(k))){e||(k=c(k,e,f));var l=-1,m=k.length,n=j.length;for(j.length+=m;++l<m;)j[n++]=k[l]}else f||j.push(k)}return j}return c}),c("lodash-amd/modern/utilities/noop",[],function(){function a(){}return a}),c("lodash-amd/modern/internals/baseCreate",["./isNative","../objects/isObject","../utilities/noop"],function(a,b){function c(a){return b(a)?d(a):{}}var d=a(d=Object.create)&&d;return d||(c=function(){function a(){}return function(c){if(b(c)){a.prototype=c;var d=new a;a.prototype=null}return d||window.Object()}}()),c}),c("lodash-amd/modern/internals/setBindData",["./isNative","../utilities/noop"],function(a,b){var c={configurable:!1,enumerable:!1,value:null,writable:!1},d=function(){try{var b={},c=a(c=Object.defineProperty)&&c,d=c(b,b,b)&&c}catch(e){}return d}(),e=d?function(a,b){c.value=b,d(a,"__bindData__",c)}:b;return e}),c("lodash-amd/modern/internals/slice",[],function(){function a(a,b,c){b||(b=0),"undefined"==typeof c&&(c=a?a.length:0);for(var d=-1,e=c-b||0,f=Array(0>e?0:e);++d<e;)f[d]=a[b+d];return f}return a}),c("lodash-amd/modern/internals/baseBind",["./baseCreate","../objects/isObject","./setBindData","./slice"],function(a,b,c,d){function e(e){function f(){if(i){var c=d(i);g.apply(c,arguments)}if(this instanceof f){var e=a(h.prototype),k=h.apply(e,c||arguments);return b(k)?k:e}return h.apply(j,c||arguments)}var h=e[0],i=e[2],j=e[4];return c(f,e),f}var f=[],g=f.push;return e}),c("lodash-amd/modern/internals/baseCreateWrapper",["./baseCreate","../objects/isObject","./setBindData","./slice"],function(a,b,c,d){function e(f){function h(){var c=o?m:this;if(k){var f=d(k);g.apply(f,arguments)}if((l||q)&&(f||(f=d(arguments)),l&&g.apply(f,l),q&&f.length<n))return j|=16,e([i,r?j:-4&j,f,null,m,n]);if(f||(f=arguments),p&&(i=c[s]),this instanceof h){c=a(i.prototype);var t=i.apply(c,f);return b(t)?t:c}return i.apply(c,f)}var i=f[0],j=f[1],k=f[2],l=f[3],m=f[4],n=f[5],o=1&j,p=2&j,q=4&j,r=8&j,s=i;return c(h,f),h}var f=[],g=f.push;return e}),c("lodash-amd/modern/objects/isFunction",[],function(){function a(a){return"function"==typeof a}return a}),c("lodash-amd/modern/internals/createWrapper",["./baseBind","./baseCreateWrapper","../objects/isFunction","./slice"],function(a,b,c,d){function e(f,i,j,k,l,m){var n=1&i,o=2&i,p=4&i,q=16&i,r=32&i;if(!o&&!c(f))throw new TypeError;q&&!j.length&&(i&=-17,q=j=!1),r&&!k.length&&(i&=-33,r=k=!1);var s=f&&f.__bindData__;if(s&&s!==!0)return s=d(s),s[2]&&(s[2]=d(s[2])),s[3]&&(s[3]=d(s[3])),!n||1&s[1]||(s[4]=l),!n&&1&s[1]&&(i|=8),!p||4&s[1]||(s[5]=m),q&&g.apply(s[2]||(s[2]=[]),j),r&&h.apply(s[3]||(s[3]=[]),k),s[1]|=i,e.apply(null,s);var t=1==i||17===i?a:b;return t([f,i,j,k,l,m])}var f=[],g=f.push,h=f.unshift;return e}),c("lodash-amd/modern/functions/bind",["../internals/createWrapper","../internals/slice"],function(a,b){function c(c,d){return arguments.length>2?a(c,17,b(arguments,2),null,d):a(c,1,null,null,d)}return c}),c("lodash-amd/modern/utilities/identity",[],function(){function a(a){return a}return a}),c("lodash-amd/modern/support",["./internals/isNative"],function(a){var b=/\bthis\b/,c={};return c.funcDecomp=!a(window.WinRTError)&&b.test(function(){return this}),c.funcNames="string"==typeof Function.name,c}),c("lodash-amd/modern/internals/baseCreateCallback",["../functions/bind","../utilities/identity","./setBindData","../support"],function(a,b,c,d){function e(e,i,j){if("function"!=typeof e)return b;if("undefined"==typeof i||!("prototype"in e))return e;var k=e.__bindData__;if("undefined"==typeof k&&(d.funcNames&&(k=!e.name),k=k||!d.funcDecomp,!k)){var l=h.call(e);d.funcNames||(k=!f.test(l)),k||(k=g.test(l),c(e,k))}if(k===!1||k!==!0&&1&k[1])return e;switch(j){case 1:return function(a){return e.call(i,a)};case 2:return function(a,b){return e.call(i,a,b)};case 3:return function(a,b,c){return e.call(i,a,b,c)};case 4:return function(a,b,c,d){return e.call(i,a,b,c,d)}}return a(e,i)}var f=/^\s*function[ \n\r\t]+\w/,g=/\bthis\b/,h=Function.prototype.toString;return e}),c("lodash-amd/modern/objects/forIn",["../internals/baseCreateCallback","../internals/objectTypes"],function(a,b){var c=function(c,d,e){var f,g=c,h=g;if(!g)return h;if(!b[typeof g])return h;d=d&&"undefined"==typeof e?d:a(d,e,3);for(f in g)if(d(g[f],f,c)===!1)return h;return h};return c}),c("lodash-amd/modern/internals/arrayPool",[],function(){var a=[];return a}),c("lodash-amd/modern/internals/getArray",["./arrayPool"],function(a){function b(){return a.pop()||[]}return b}),c("lodash-amd/modern/internals/maxPoolSize",[],function(){var a=40;return a}),c("lodash-amd/modern/internals/releaseArray",["./arrayPool","./maxPoolSize"],function(a,b){function c(c){c.length=0,a.length<b&&a.push(c)}return c}),c("lodash-amd/modern/internals/baseIsEqual",["../objects/forIn","./getArray","../objects/isFunction","./objectTypes","./releaseArray"],function(a,b,c,d,e){function f(o,r,s,t,u,v){if(s){var w=s(o,r);if("undefined"!=typeof w)return!!w}if(o===r)return 0!==o||1/o==1/r;var x=typeof o,y=typeof r;if(!(o!==o||o&&d[x]||r&&d[y]))return!1;if(null==o||null==r)return o===r;var z=p.call(o),A=p.call(r);if(z==g&&(z=l),A==g&&(A=l),z!=A)return!1;switch(z){case i:case j:return+o==+r;case k:return o!=+o?r!=+r:0==o?1/o==1/r:o==+r;case m:case n:return o==String(r)}var B=z==h;if(!B){var C=q.call(o,"__wrapped__"),D=q.call(r,"__wrapped__");if(C||D)return f(C?o.__wrapped__:o,D?r.__wrapped__:r,s,t,u,v);if(z!=l)return!1;var E=o.constructor,F=r.constructor;if(E!=F&&!(c(E)&&E instanceof E&&c(F)&&F instanceof F)&&"constructor"in o&&"constructor"in r)return!1}var G=!u;u||(u=b()),v||(v=b());for(var H=u.length;H--;)if(u[H]==o)return v[H]==r;var I=0;if(w=!0,u.push(o),v.push(r),B){if(H=o.length,I=r.length,w=I==H,w||t)for(;I--;){var J=H,K=r[I];if(t)for(;J--&&!(w=f(o[J],K,s,t,u,v)););else if(!(w=f(o[I],K,s,t,u,v)))break}}else a(r,function(a,b,c){return q.call(c,b)?(I++,w=q.call(o,b)&&f(o[b],a,s,t,u,v)):void 0}),w&&!t&&a(o,function(a,b,c){return q.call(c,b)?w=--I>-1:void 0});return u.pop(),v.pop(),G&&(e(u),e(v)),w}var g="[object Arguments]",h="[object Array]",i="[object Boolean]",j="[object Date]",k="[object Number]",l="[object Object]",m="[object RegExp]",n="[object String]",o=Object.prototype,p=o.toString,q=o.hasOwnProperty;return f}),c("lodash-amd/modern/utilities/property",[],function(){function a(a){return function(b){return b[a]}}return a}),c("lodash-amd/modern/functions/createCallback",["../internals/baseCreateCallback","../internals/baseIsEqual","../objects/isObject","../objects/keys","../utilities/property"],function(a,b,c,d,e){function f(f,g,h){var i=typeof f;if(null==f||"function"==i)return a(f,g,h);if("object"!=i)return e(f);var j=d(f),k=j[0],l=f[k];return 1!=j.length||l!==l||c(l)?function(a){for(var c=j.length,d=!1;c--&&(d=b(a[j[c]],f[j[c]],null,!0)););return d}:function(a){var b=a[k];return l===b&&(0!==l||1/l==1/b)}}return f}),c("lodash-amd/modern/objects/forOwn",["../internals/baseCreateCallback","./keys","../internals/objectTypes"],function(a,b,c){var d=function(d,e,f){var g,h=d,i=h;if(!h)return i;if(!c[typeof h])return i;e=e&&"undefined"==typeof f?e:a(e,f,3);for(var j=-1,k=c[typeof h]&&b(h),l=k?k.length:0;++j<l;)if(g=k[j],e(h[g],g,d)===!1)return i;return i};return d}),c("lodash-amd/modern/collections/map",["../functions/createCallback","../objects/forOwn"],function(a,b){function c(c,d,e){var f=-1,g=c?c.length:0;if(d=a(d,e,3),"number"==typeof g)for(var h=Array(g);++f<g;)h[f]=d(c[f],f,c);else h=[],b(c,function(a,b,c){h[++f]=d(a,b,c)});return h}return c}),c("lodash-amd/modern/arrays/flatten",["../internals/baseFlatten","../collections/map"],function(a,b){function c(c,d,e,f){return"boolean"!=typeof d&&null!=d&&(f=e,e="function"!=typeof d&&f&&f[d]===c?null:d,d=!1),null!=e&&(c=b(c,e,f)),a(c,d)}return c}),c("plugins/core/commands/indent",[],function(){return function(){return function(a){var b=new a.api.Command("indent");b.queryEnabled=function(){var b=new a.api.Selection,c=b.getContaining(function(a){return"UL"===a.nodeName||"OL"===a.nodeName});return a.api.Command.prototype.queryEnabled.call(this)&&a.allowsBlockElements()&&!c},a.commands.indent=b}}}),c("plugins/core/commands/insert-list",[],function(){return function(){return function(a){var b=function(b){a.api.Command.call(this,b)};b.prototype=Object.create(a.api.Command.prototype),b.prototype.constructor=b,b.prototype.execute=function(b){function c(a){if(a.length>0){var b=document.createElement(f.nodeName);a.forEach(function(a){b.appendChild(a)}),f.parentNode.insertBefore(b,f.nextElementSibling)}}if(this.queryState()){var d=new a.api.Selection,e=d.range,f=d.getContaining(function(a){return"OL"===a.nodeName||"UL"===a.nodeName}),g=d.getContaining(function(a){return"LI"===a.nodeName});a.transactionManager.run(function(){if(g){var b=new a.api.Node(g).nextAll();c(b),d.placeMarkers();var h=document.createElement("p");h.innerHTML=g.innerHTML,f.parentNode.insertBefore(h,f.nextElementSibling),g.parentNode.removeChild(g)}else{var i=Array.prototype.map.call(f.querySelectorAll("li"),function(a){return e.intersectsNode(a)&&a}).filter(function(a){return a}),j=i.slice(-1)[0],k=new a.api.Node(j).nextAll();c(k),d.placeMarkers();var l=document.createDocumentFragment();i.forEach(function(a){var b=document.createElement("p");b.innerHTML=a.innerHTML,l.appendChild(b)}),f.parentNode.insertBefore(l,f.nextElementSibling),i.forEach(function(a){a.parentNode.removeChild(a)})}0===f.childNodes.length&&f.parentNode.removeChild(f),d.selectMarkers()}.bind(this))}else a.api.Command.prototype.execute.call(this,b)},b.prototype.queryEnabled=function(){return a.api.Command.prototype.queryEnabled.call(this)&&a.allowsBlockElements()},a.commands.insertOrderedList=new b("insertOrderedList"),a.commands.insertUnorderedList=new b("insertUnorderedList")}}}),c("plugins/core/commands/outdent",[],function(){return function(){return function(a){var b=new a.api.Command("outdent");b.queryEnabled=function(){var b=new a.api.Selection,c=b.getContaining(function(a){return"UL"===a.nodeName||"OL"===a.nodeName});return a.api.Command.prototype.queryEnabled.call(this)&&a.allowsBlockElements()&&!c},a.commands.outdent=b}}}),c("plugins/core/commands/redo",[],function(){return function(){return function(a){var b=new a.api.Command("redo");b.execute=function(){var b=a.undoManager.redo();"undefined"!=typeof b&&a.restoreFromHistory(b)},b.queryEnabled=function(){return a.undoManager.position<a.undoManager.stack.length-1},a.commands.redo=b,a.el.addEventListener("keydown",function(a){a.shiftKey&&(a.metaKey||a.ctrlKey)&&90===a.keyCode&&(a.preventDefault(),b.execute())})}}}),c("plugins/core/commands/subscript",[],function(){return function(){return function(a){var b=new a.api.Command("subscript");a.commands.subscript=b}}}),c("plugins/core/commands/superscript",[],function(){return function(){return function(a){var b=new a.api.Command("superscript");a.commands.superscript=b}}}),c("plugins/core/commands/undo",[],function(){return function(){return function(a){var b=new a.api.Command("undo");b.execute=function(){var b=a.undoManager.undo();"undefined"!=typeof b&&a.restoreFromHistory(b)},b.queryEnabled=function(){return a.undoManager.position>1},a.commands.undo=b,a.el.addEventListener("keydown",function(a){a.shiftKey||!a.metaKey&&!a.ctrlKey||90!==a.keyCode||(a.preventDefault(),b.execute())})}}}),c("plugins/core/commands",["./commands/indent","./commands/insert-list","./commands/outdent","./commands/redo","./commands/subscript","./commands/superscript","./commands/undo"],function(a,b,c,d,e,f,g){return{indent:a,insertList:b,outdent:c,redo:d,subscript:e,superscript:f,undo:g}}),c("lodash-amd/modern/internals/baseIndexOf",[],function(){function a(a,b,c){for(var d=(c||0)-1,e=a?a.length:0;++d<e;)if(a[d]===b)return d;return-1}return a}),c("lodash-amd/modern/objects/isString",[],function(){function a(a){return"string"==typeof a||a&&"object"==typeof a&&d.call(a)==b||!1}var b="[object String]",c=Object.prototype,d=c.toString;return a}),c("lodash-amd/modern/collections/contains",["../internals/baseIndexOf","../objects/forOwn","../objects/isArray","../objects/isString"],function(a,b,c,d){function e(e,g,h){var i=-1,j=a,k=e?e.length:0,l=!1;return h=(0>h?f(0,k+h):h)||0,c(e)?l=j(e,g,h)>-1:"number"==typeof k?l=(d(e)?e.indexOf(g,h):j(e,g,h))>-1:b(e,function(a){return++i>=h?!(l=a===g):void 0}),l}var f=Math.max;return e}),c("lodash-amd/modern/objects/values",["./keys"],function(a){function b(b){for(var c=-1,d=a(b),e=d.length,f=Array(e);++c<e;)f[c]=b[d[c]];return f}return b}),c("lodash-amd/modern/collections/toArray",["../objects/isString","../internals/slice","../objects/values"],function(a,b,c){function d(a){return a&&"number"==typeof a.length?b(a):c(a)}return d}),c("scribe-common/src/element",["lodash-amd/modern/collections/contains"],function(a){function b(b){return a(e,b.nodeName)}function c(a){return a.nodeType===Node.ELEMENT_NODE&&"scribe-marker"===a.className}function d(a,b){for(;b.childNodes.length>0;)a.insertBefore(b.childNodes[0],b);a.removeChild(b)}var e=["P","LI","DIV","BLOCKQUOTE","UL","OL","H1","H2","H3","H4","H5","H6"];return{isBlockElement:b,isSelectionMarkerNode:c,unwrap:d}}),c("scribe-common/src/node",[],function(){function a(a){return a.nodeType===Node.TEXT_NODE&&""===a.textContent}function b(a,b){return b.parentNode.insertBefore(a,b.nextSibling)}function c(a){return a.parentNode.removeChild(a)}return{isEmptyTextNode:a,insertAfter:b,removeNode:c}}),c("dom-observer",["lodash-amd/modern/arrays/flatten","lodash-amd/modern/collections/toArray","scribe-common/src/element","scribe-common/src/node"],function(a,b,c,d){function e(e,f){function g(e){var f=a(e.map(function(a){var c=b(a.addedNodes),d=b(a.removedNodes);return c.concat(d)})),g=f.filter(function(a){return!d.isEmptyTextNode(a)}).filter(function(a){return!c.isSelectionMarkerNode(a)});return g.length>0}var h=!1,i=new MutationObserver(function(a){if(!h&&g(a)){h=!0;try{f()}finally{setTimeout(function(){h=!1},0)}}});return i.observe(e,{attributes:!0,childList:!0,subtree:!0}),i}return e}),c("plugins/core/events",["lodash-amd/modern/collections/contains","../../dom-observer"],function(a,b){return function(){return function(c){function d(){var a=navigator.userAgent;return a.search("Safari")>=0&&a.search("Chrome")<0}var e=function(){setTimeout(function(){c.pushHistory()}.bind(c),0),c.el.removeEventListener("focus",e)}.bind(c);c.el.addEventListener("focus",e),c.el.addEventListener("focus",function(){function a(b){var c=document.createTreeWalker(b),d=c.currentNode;return c.firstChild()?"BR"===c.currentNode.nodeName?d:a(c.currentNode):c.currentNode}var b=new c.api.Selection;if(b.range){var d=c.allowsBlockElements()&&b.range.startContainer===c.el;if(d){var e=a(c.el.firstChild),f=b.range;f.setStart(e,0),f.setEnd(e,0),b.selection.removeAllRanges(),b.selection.addRange(f)}}}.bind(c));var f=function(){if(!c._skipFormatters){var a=new c.api.Selection,b=a.range,d=function(){b&&a.placeMarkers(),c.setHTML(c._htmlFormatterFactory.format(c.getHTML())),a.selectMarkers()}.bind(c);b?(c.undoManager.undo(),c.transactionManager.run(d)):d()}delete c._skipFormatters}.bind(c);b(c.el,f),c.allowsBlockElements()&&c.el.addEventListener("keydown",function(a){if(13===a.keyCode){var b=new c.api.Selection,d=b.range,e=b.getContaining(function(a){return/^(H[1-6])$/.test(a.nodeName)});if(e&&d.collapsed){var f=d.cloneRange();f.setEndAfter(e,0);var g=f.cloneContents();""===g.firstChild.textContent&&(a.preventDefault(),c.transactionManager.run(function(){var a=document.createElement("p"),c=document.createElement("br");a.appendChild(c),e.parentNode.insertBefore(a,e.nextElementSibling),d.setStart(a,0),d.setEnd(a,0),b.selection.removeAllRanges(),b.selection.addRange(d)}))}}}),c.allowsBlockElements()&&c.el.addEventListener("keydown",function(a){if(13===a.keyCode||8===a.keyCode){var b=new c.api.Selection,d=b.range;if(d.collapsed){var e=b.getContaining(function(a){return"LI"===a.nodeName});if(e&&""===e.textContent.trim()){a.preventDefault();var f=b.getContaining(function(a){return"UL"===a.nodeName||"OL"===a.nodeName}),g=c.getCommand("OL"===f.nodeName?"insertOrderedList":"insertUnorderedList");g.execute()}}}}),c.el.addEventListener("paste",function(b){if(!b.clipboardData||!a(b.clipboardData.types,"text/html")&&d()){var e=new c.api.Selection;e.placeMarkers();var f=document.createElement("div");document.body.appendChild(f),f.setAttribute("contenteditable",!0),f.focus(),setTimeout(function(){var a=f.innerHTML;f.parentNode.removeChild(f),e.selectMarkers(),c.el.focus(),a=c._htmlFormatterFactory.formatPaste(a),c.insertHTML(a)},1)}else if(b.preventDefault(),a(b.clipboardData.types,"text/html")){var g=b.clipboardData.getData("text/html");g=c._htmlFormatterFactory.formatPaste(g),c.insertHTML(g)}else c.insertPlainText(b.clipboardData.getData("text/plain"))})}}}),c("plugins/core/formatters/html/replace-nbsp-chars",[],function(){return function(){return function(a){var b=/(\s|&nbsp;)+/g;a.registerHTMLFormatter("export",function(a){return a.replace(b," ")})}}}),c("lodash-amd/modern/arrays/last",["../functions/createCallback","../internals/slice"],function(a,b){function c(c,f,g){var h=0,i=c?c.length:0;if("number"!=typeof f&&null!=f){var j=i;for(f=a(f,g,3);j--&&f(c[j],j,c);)h++}else if(h=f,null==h||g)return c?c[i-1]:d;return b(c,e(0,i-h))}var d,e=Math.max;return c}),c("plugins/core/formatters/html/enforce-p-elements",["lodash-amd/modern/arrays/last","scribe-common/src/element"],function(a,b){function c(c){var d=Array.prototype.reduce.call(c.childNodes,function(c,d){function e(){var a=[d];c.push(a)}var f=a(c);if(f){var g=b.isBlockElement(f[0]);g===b.isBlockElement(d)?f.push(d):e()}else e();return c},[]),e=d.filter(function(a){var c=b.isBlockElement(a[0]);return!c});e.forEach(function(a){var b=document.createElement("p");a[0].parentNode.insertBefore(b,a[0]),a.forEach(function(a){b.appendChild(a)})}),c._isWrapped=!0}function d(a){for(var b=document.createTreeWalker(a,NodeFilter.SHOW_ELEMENT),e=b.firstChild();e;){if("BLOCKQUOTE"===e.nodeName&&!e._isWrapped){c(e),d(a);break}e=b.nextSibling()}}return function(){return function(a){a.registerHTMLFormatter("normalize",function(a){var b=document.createElement("div");return b.innerHTML=a,c(b),d(b),b.innerHTML})}}}),c("plugins/core/formatters/html/ensure-selectable-containers",["scribe-common/src/element","lodash-amd/modern/collections/contains"],function(a,b){function c(e){function f(b){return 0===b.children.length||1===b.children.length&&a.isSelectionMarkerNode(b.children[0])}for(var g=e.firstElementChild;g;)a.isSelectionMarkerNode(g)||(f(g)&&""===g.textContent.trim()&&!b(d,g.nodeName)?g.appendChild(document.createElement("br")):g.children.length>0&&c(g)),g=g.nextElementSibling}var d=["AREA","BASE","BR","COL","COMMAND","EMBED","HR","IMG","INPUT","KEYGEN","LINK","META","PARAM","SOURCE","TRACK","WBR"];return function(){return function(a){a.registerHTMLFormatter("normalize",function(a){var b=document.createElement("div");return b.innerHTML=a,c(b),b.innerHTML})}}}),c("lodash-amd/modern/internals/htmlEscapes",[],function(){var a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return a}),c("lodash-amd/modern/internals/escapeHtmlChar",["./htmlEscapes"],function(a){function b(b){return a[b]}return b}),c("lodash-amd/modern/internals/reUnescapedHtml",["./htmlEscapes","../objects/keys"],function(a,b){var c=RegExp("["+b(a).join("")+"]","g");return c}),c("lodash-amd/modern/utilities/escape",["../internals/escapeHtmlChar","../objects/keys","../internals/reUnescapedHtml"],function(a,b,c){function d(b){return null==b?"":String(b).replace(c,a)}return d}),c("plugins/core/formatters/plain-text/escape-html-characters",["lodash-amd/modern/utilities/escape"],function(a){return function(){return function(b){b.registerPlainTextFormatter(a)}}}),c("plugins/core/inline-elements-mode",[],function(){function a(a){for(var b=document.createTreeWalker(a);b.nextNode();)if(b.currentNode&&(~["br"].indexOf(b.currentNode.nodeName.toLowerCase())||b.currentNode.length>0))return!0;return!1}return function(){return function(b){b.el.addEventListener("keydown",function(c){if(13===c.keyCode){var d=new b.api.Selection,e=d.range,f=d.getContaining(function(a){return"LI"===a.nodeName||/^(H[1-6])$/.test(a.nodeName)});f||(c.preventDefault(),b.transactionManager.run(function(){"BR"===b.el.lastChild.nodeName&&b.el.removeChild(b.el.lastChild);var c=document.createElement("br");e.insertNode(c),e.collapse(!1);var f=e.cloneRange();f.setEndAfter(b.el.lastChild,0);var g=f.cloneContents();if(!a(g)){var h=document.createElement("br");e.insertNode(h)}var i=e.cloneRange();i.setStartAfter(c,0),i.setEndAfter(c,0),d.selection.removeAllRanges(),d.selection.addRange(i)}))}}.bind(this)),""===b.getHTML().trim()&&b.setContent("")}}}),c("plugins/core/patches/commands/indent",[],function(){var a="﻿";return function(){return function(b){var c=new b.api.CommandPatch("indent");c.execute=function(c){b.transactionManager.run(function(){var d=new b.api.Selection,e=d.range,f="P"===e.commonAncestorContainer.nodeName&&"<br>"===e.commonAncestorContainer.innerHTML;if(f){var g=document.createTextNode(a);e.insertNode(g),e.setStart(g,0),e.setEnd(g,0),d.selection.removeAllRanges(),d.selection.addRange(e)}b.api.CommandPatch.prototype.execute.call(this,c),d=new b.api.Selection;var h=d.getContaining(function(a){return"BLOCKQUOTE"===a.nodeName});h&&h.removeAttribute("style")}.bind(this))},b.commandPatches.indent=c}}}),c("plugins/core/patches/commands/insert-html",["scribe-common/src/element"],function(a){return function(){return function(b){var c=new b.api.CommandPatch("insertHTML");c.execute=function(c){b.transactionManager.run(function(){function d(b){var c=document.createTreeWalker(b,NodeFilter.SHOW_ELEMENT),e=c.firstChild();if(e)do"SPAN"===e.nodeName?a.unwrap(b,e):(e.style.lineHeight=null,""===e.getAttribute("style")&&e.removeAttribute("style")),d(e);while(e=c.nextSibling())}b.api.CommandPatch.prototype.execute.call(this,c),d(b.el)}.bind(this))},b.commandPatches.insertHTML=c}}}),c("plugins/core/patches/commands/insert-list",["scribe-common/src/element","scribe-common/src/node"],function(a,b){return function(){return function(c){var d=function(a){c.api.CommandPatch.call(this,a)};d.prototype=Object.create(c.api.CommandPatch.prototype),d.prototype.constructor=d,d.prototype.execute=function(d){c.transactionManager.run(function(){if(c.api.CommandPatch.prototype.execute.call(this,d),this.queryState()){var e=new c.api.Selection,f=e.getContaining(function(a){return"OL"===a.nodeName||"UL"===a.nodeName});if(f.nextElementSibling&&0===f.nextElementSibling.childNodes.length&&b.removeNode(f.nextElementSibling),f){var g=f.parentNode;g&&/^(H[1-6]|P)$/.test(g.nodeName)&&(e.placeMarkers(),b.insertAfter(f,g),e.selectMarkers(),2===g.childNodes.length&&b.isEmptyTextNode(g.firstChild)&&b.removeNode(g),0===g.childNodes.length&&b.removeNode(g))}var h=Array.prototype.slice.call(f.childNodes);h.forEach(function(b){var c=Array.prototype.slice.call(b.childNodes);c.forEach(function(c){if("SPAN"===c.nodeName){var d=c;a.unwrap(b,d)}else c.nodeType===Node.ELEMENT_NODE&&(c.style.lineHeight=null,""===c.getAttribute("style")&&c.removeAttribute("style"))})})}}.bind(this))},c.commandPatches.insertOrderedList=new d("insertOrderedList"),c.commandPatches.insertUnorderedList=new d("insertUnorderedList")}}}),c("plugins/core/patches/commands/outdent",[],function(){return function(){return function(a){var b=new a.api.CommandPatch("outdent");b.execute=function(){a.transactionManager.run(function(){var b=new a.api.Selection,c=b.range,d=b.getContaining(function(a){return"BLOCKQUOTE"===a.nodeName});if("BLOCKQUOTE"===c.commonAncestorContainer.nodeName){b.placeMarkers(),b.selectMarkers(!0);var e=c.cloneContents();d.parentNode.insertBefore(e,d),c.deleteContents(),b.selectMarkers(),""===d.textContent&&d.parentNode.removeChild(d)}else{var f=b.getContaining(function(a){return"P"===a.nodeName});if(f){var g=new a.api.Node(f).nextAll();if(g.length){var h=document.createElement(d.nodeName);g.forEach(function(a){h.appendChild(a)}),d.parentNode.insertBefore(h,d.nextElementSibling)}b.placeMarkers(),d.parentNode.insertBefore(f,d.nextElementSibling),b.selectMarkers(),""===d.innerHTML&&d.parentNode.removeChild(d)}else a.api.CommandPatch.prototype.execute.call(this)}}.bind(this))},a.commandPatches.outdent=b}}}),c("plugins/core/patches/commands/create-link",[],function(){return function(){return function(a){var b=new a.api.CommandPatch("createLink");a.commandPatches.createLink=b,b.execute=function(b){var c=new a.api.Selection;if(c.selection.isCollapsed){var d=document.createElement("a");d.setAttribute("href",b),d.textContent=b,c.range.insertNode(d);var e=document.createRange();e.setStartBefore(d),e.setEndAfter(d),c.selection.removeAllRanges(),c.selection.addRange(e)}else a.api.CommandPatch.prototype.execute.call(this,b)}}}}),c("plugins/core/patches/events",["scribe-common/src/element"],function(a){return function(){return function(b){b.allowsBlockElements()&&b.el.addEventListener("keyup",function(c){if(8===c.keyCode||46===c.keyCode){var d=new b.api.Selection,e=d.getContaining(function(a){return"P"===a.nodeName});e&&(b.undoManager.undo(),b.transactionManager.run(function(){d.placeMarkers();var b=Array.prototype.slice.call(e.childNodes);b.forEach(function(b){if("SPAN"===b.nodeName){var c=b;a.unwrap(e,c)}else b.nodeType===Node.ELEMENT_NODE&&(b.style.lineHeight=null,""===b.getAttribute("style")&&b.removeAttribute("style"))}),d.selectMarkers()}))}})}}}),c("plugins/core/patches",["./patches/commands/indent","./patches/commands/insert-html","./patches/commands/insert-list","./patches/commands/outdent","./patches/commands/create-link","./patches/events"],function(a,b,c,d,e,f){return{commands:{indent:a,insertHTML:b,insertList:c,outdent:d,createLink:e},events:f}}),c("plugins/core/set-root-p-element",[],function(){return function(){return function(a){""===a.getHTML().trim()&&a.setContent("<p><br></p>")}}}),c("api/command-patch",[],function(){return function(a){function b(a){this.commandName=a}return b.prototype.execute=function(b){a.transactionManager.run(function(){document.execCommand(this.commandName,!1,b||null)}.bind(this))},b.prototype.queryState=function(){return"insertOrderedList"===this.commandName||"insertUnorderedList"==this.commandName?!1:document.queryCommandState(this.commandName)},b.prototype.queryEnabled=function(){return document.queryCommandEnabled(this.commandName)},b}}),c("api/command",[],function(){return function(a){function b(b){this.commandName=b,this.patch=a.commandPatches[this.commandName]}return b.prototype.execute=function(b){this.patch?this.patch.execute(b):a.transactionManager.run(function(){document.execCommand(this.commandName,!1,b||null)}.bind(this))},b.prototype.queryState=function(){return this.patch?this.patch.queryState():document.queryCommandState(this.commandName)},b.prototype.queryEnabled=function(){return this.patch?this.patch.queryEnabled():document.queryCommandEnabled(this.commandName)},b}}),c("api/node",[],function(){function a(a){this.node=a}return a.prototype.getAncestor=function(a){var b=function(a){return a&&a.attributes&&a.attributes.getNamedItem("contenteditable")};if(!b(this.node))for(var c=this.node.parentNode;c&&!b(c);){if(a(c))return c;
c=c.parentNode}},a.prototype.nextAll=function(){for(var a=[],b=this.node.nextSibling;b;)a.push(b),b=b.nextSibling;return a},a}),c("api/selection",[],function(){return function(a){function b(){this.selection=window.getSelection(),this.selection.rangeCount&&(this.range=this.selection.getRangeAt(0))}return b.prototype.getContaining=function(b){if(this.range){var c=new a.api.Node(this.range.commonAncestorContainer),d=c.node&&c.node.attributes&&c.node.attributes.getNamedItem("contenteditable");return!d&&b(c.node)?c.node:c.getAncestor(b)}},b.prototype.placeMarkers=function(){if(this.range){var a=document.createElement("em");a.classList.add("scribe-marker");var b=document.createElement("em");b.classList.add("scribe-marker");var c=this.range.cloneRange();if(c.collapse(!1),c.insertNode(b),b.nextSibling&&b.nextSibling.nodeType===Node.TEXT_NODE&&""===b.nextSibling.data&&b.parentNode.removeChild(b.nextSibling),b.previousSibling&&b.previousSibling.nodeType===Node.TEXT_NODE&&""===b.previousSibling.data&&b.parentNode.removeChild(b.previousSibling),!this.selection.isCollapsed){var d=this.range.cloneRange();d.collapse(!0),d.insertNode(a),a.nextSibling&&a.nextSibling.nodeType===Node.TEXT_NODE&&""===a.nextSibling.data&&a.parentNode.removeChild(a.nextSibling),a.previousSibling&&a.previousSibling.nodeType===Node.TEXT_NODE&&""===a.previousSibling.data&&a.parentNode.removeChild(a.previousSibling)}this.selection.removeAllRanges(),this.selection.addRange(this.range)}},b.prototype.getMarkers=function(){return a.el.querySelectorAll("em.scribe-marker")},b.prototype.removeMarkers=function(){var a=this.getMarkers();Array.prototype.forEach.call(a,function(a){a.parentNode.removeChild(a)})},b.prototype.selectMarkers=function(a){var b=this.getMarkers();if(b.length){var c=document.createRange();c.setStartBefore(b[0]),c.setEndAfter(b.length>=2?b[1]:b[0]),a||this.removeMarkers(),this.selection.removeAllRanges(),this.selection.addRange(c)}},b.prototype.isCaretOnNewLine=function(){var a=this.getContaining(function(a){return"P"===a.nodeName});if(a){var b=a.innerHTML.trim();return"P"===a.nodeName&&("<br>"===b||""===b)}return!1},b}}),c("api/simple-command",[],function(){return function(a,b){function c(a,c){b.api.Command.call(this,a),this.nodeName=c}return c.prototype=Object.create(a.Command.prototype),c.prototype.constructor=c,c.prototype.queryState=function(){var a=new b.api.Selection;return b.api.Command.prototype.queryState.call(this)&&!!a.getContaining(function(a){return a.nodeName===this.nodeName}.bind(this))},c}}),c("api",["./api/command-patch","./api/command","./api/node","./api/selection","./api/simple-command"],function(a,b,c,d,e){return function(f){this.CommandPatch=a(f),this.Command=b(f),this.Node=c,this.Selection=d(f),this.SimpleCommand=e(this,f)}}),c("lodash-amd/modern/objects/assign",["../internals/baseCreateCallback","./keys","../internals/objectTypes"],function(a,b,c){var d=function(d,e,f){var g,h=d,i=h;if(!h)return i;var j=arguments,k=0,l="number"==typeof f?2:j.length;if(l>3&&"function"==typeof j[l-2])var m=a(j[--l-1],j[l--],2);else l>2&&"function"==typeof j[l-1]&&(m=j[--l]);for(;++k<l;)if(h=j[k],h&&c[typeof h])for(var n=-1,o=c[typeof h]&&b(h),p=o?o.length:0;++n<p;)g=o[n],i[g]=m?m(i[g],h[g]):h[g];return i};return d}),c("transaction-manager",["lodash-amd/modern/objects/assign"],function(a){return function(b){function c(){this.history=[]}return a(c.prototype,{start:function(){this.history.push(1)},end:function(){this.history.pop(),0===this.history.length&&(b.pushHistory(),b.trigger("content-changed"))},run:function(a){this.start();try{a&&a()}finally{this.end()}}}),c}}),c("undo-manager",[],function(){return function(a){function b(){this.position=-1,this.stack=[],this.debug=a.isDebugModeEnabled()}return b.prototype.maxStackSize=100,b.prototype.push=function(a){for(this.debug&&console.log("UndoManager.push: %s",a),this.stack.length=++this.position,this.stack.push(a);this.stack.length>this.maxStackSize;)this.stack.shift(),--this.position},b.prototype.undo=function(){return this.position>0?this.stack[--this.position]:void 0},b.prototype.redo=function(){return this.position<this.stack.length-1?this.stack[++this.position]:void 0},b}}),c("lodash-amd/modern/arrays/pull",[],function(){function a(a){for(var b=arguments,d=0,e=b.length,f=a?a.length:0;++d<e;)for(var g=-1,h=b[d];++g<f;)a[g]===h&&(c.call(a,g--,1),f--);return a}var b=[],c=b.splice;return a}),c("event-emitter",["lodash-amd/modern/arrays/pull"],function(a){function b(){this._listeners={}}return b.prototype.on=function(a,b){var c=this._listeners[a]||[];c.push(b),this._listeners[a]=c},b.prototype.off=function(b,c){var d=this._listeners[b]||[];c?a(d,c):delete this._listeners[b]},b.prototype.trigger=function(a,b){var c=this._listeners[a]||[];c.forEach(function(a){a.apply(null,b)})},b}),c("scribe",["lodash-amd/modern/objects/defaults","lodash-amd/modern/arrays/flatten","./plugins/core/commands","./plugins/core/events","./plugins/core/formatters/html/replace-nbsp-chars","./plugins/core/formatters/html/enforce-p-elements","./plugins/core/formatters/html/ensure-selectable-containers","./plugins/core/formatters/plain-text/escape-html-characters","./plugins/core/inline-elements-mode","./plugins/core/patches","./plugins/core/set-root-p-element","./api","./transaction-manager","./undo-manager","./event-emitter"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(b,p){o.call(this),this.el=b,this.commands={},this.options=a(p||{},{allowBlockElements:!0,debug:!1}),this.commandPatches={},this._plainTextFormatterFactory=new q,this._htmlFormatterFactory=new r,this.api=new l(this);var s=m(this);this.transactionManager=new s;var t=n(this);this.undoManager=new t,this.el.setAttribute("contenteditable",!0),this.el.addEventListener("input",function(){this.transactionManager.run()}.bind(this),!1),this.allowsBlockElements()?(this.use(k()),this.use(f()),this.use(g())):this.use(i()),this.use(h()),this.use(e()),this.use(j.commands.indent()),this.use(j.commands.insertHTML()),this.use(j.commands.insertList()),this.use(j.commands.outdent()),this.use(j.commands.createLink()),this.use(j.events()),this.use(c.indent()),this.use(c.insertList()),this.use(c.outdent()),this.use(c.redo()),this.use(c.subscript()),this.use(c.superscript()),this.use(c.undo()),this.use(d())}function q(){this.formatters=[]}function r(){this.formatters={sanitize:[],normalize:[],paste:[],"export":[]}}return p.prototype=Object.create(o.prototype),p.prototype.use=function(a){return a(this),this},p.prototype.setHTML=function(a,b){b&&(this._skipFormatters=!0),this.el.innerHTML=a},p.prototype.getHTML=function(){return this.el.innerHTML},p.prototype.getContent=function(){return this._htmlFormatterFactory.formatForExport(this.getHTML().replace(/<br>$/,""))},p.prototype.getTextContent=function(){return this.el.textContent},p.prototype.pushHistory=function(){var a=this.undoManager.stack[this.undoManager.position],b=a&&a.replace(/<em class="scribe-marker">/g,"").replace(/<\/em>/g,"");if(!a||a&&this.getContent()!==b){var c=new this.api.Selection;c.placeMarkers();var d=this.getHTML();return c.removeMarkers(),this.undoManager.push(d),!0}return!1},p.prototype.getCommand=function(a){return this.commands[a]||this.commandPatches[a]||new this.api.Command(a)},p.prototype.restoreFromHistory=function(a){this.setHTML(a,!0);var b=new this.api.Selection;b.selectMarkers(),this.trigger("content-changed")},p.prototype.allowsBlockElements=function(){return this.options.allowBlockElements},p.prototype.setContent=function(a){this.allowsBlockElements()||(a+="<br>"),this.setHTML(a),this.trigger("content-changed")},p.prototype.insertPlainText=function(a){this.insertHTML("<p>"+this._plainTextFormatterFactory.format(a)+"</p>")},p.prototype.insertHTML=function(a){this.getCommand("insertHTML").execute(this._htmlFormatterFactory.format(a))},p.prototype.isDebugModeEnabled=function(){return this.options.debug},p.prototype.registerHTMLFormatter=function(a,b){this._htmlFormatterFactory.formatters[a].push(b)},p.prototype.registerPlainTextFormatter=function(a){this._plainTextFormatterFactory.formatters.push(a)},q.prototype.format=function(a){var b=this.formatters.reduce(function(a,b){return b(a)},a);return b},r.prototype=Object.create(q.prototype),r.prototype.constructor=r,r.prototype.format=function(a){var c=b([this.formatters.sanitize,this.formatters.normalize]),d=c.reduce(function(a,b){return b(a)},a);return d},r.prototype.formatPaste=function(a){return this.formatters.paste.reduce(function(a,b){return b(a)},a)},r.prototype.formatForExport=function(a){return this.formatters.export.reduce(function(a,b){return b(a)},a)},p}),c("scribe-plugin-blockquote-command",[],function(){return function(){return function(a){var b=new a.api.SimpleCommand("blockquote","BLOCKQUOTE");b.execute=function(){var b=a.getCommand(this.queryState()?"outdent":"indent");b.execute()},b.queryEnabled=function(){var b=a.getCommand(this.queryState()?"outdent":"indent");return b.queryEnabled()},b.queryState=function(){var b=new a.api.Selection,c=b.getContaining(function(a){return"BLOCKQUOTE"===a.nodeName});return a.allowsBlockElements()&&!!c},a.commands.blockquote=b,a.allowsBlockElements()&&a.el.addEventListener("keydown",function(b){if(13===b.keyCode){var c=a.getCommand("blockquote");if(c.queryState()){var d=new a.api.Selection;d.isCaretOnNewLine()&&(b.preventDefault(),c.execute())}}})}}}),c("scribe-plugin-curly-quotes",[],function(){return function(){var a={34:'"',39:"'"},b="“",c="”",d="‘",e="’";return function(f){function g(g){var i,j=a[g.charCode];'"'===j?i=h()?c:b:"'"===j&&(i=h()?e:d),i&&(g.preventDefault(),f.transactionManager.run(function(){var a=k(i);l(a)}))}function h(){var a=i()||"";return j(a)}function i(){var a=new f.api.Selection,b=a.range.commonAncestorContainer.textContent;return b[a.range.startOffset-1]}function j(a){return/[^\s()]/.test(a)}function k(a){var b=document.createTextNode(a),c=new f.api.Selection;return c.range.deleteContents(),c.range.insertNode(b),b}function l(a){var b=document.createRange();b.setStartAfter(a),b.setEndAfter(a);var c=new f.api.Selection;c.selection.removeAllRanges(),c.selection.addRange(b)}function m(a){var f=document.createElement("div");return f.innerHTML=a,o(f,function(a){var f=a.split(/(<[^>]+?>)/);return f.map(function(a){return"<"===a[0]?a:a.replace(/([\s\S])?'([\s\S])?/g,n(d,e)).replace(/([\s\S])?"([\s\S])?/g,n(b,c))}).join("")}),f.innerHTML}function n(a,b){return function(c,d,e){d=d||"",e=e||"";var f=!d,g=!e,h=j(d),i=j(e);return h||f&&!i&&!g?d+b+e:d+a+e}}function o(a,b){var c=document.createTreeWalker(a,NodeFilter.SHOW_TEXT),d=c.firstChild();if(d)do d.data=b(d.data);while(d=c.nextSibling());return d}f.el.addEventListener("keypress",g),f.registerHTMLFormatter("normalize",m)}}}),c("scribe-plugin-formatter-plain-text-convert-new-lines-to-html",[],function(){return function(){return function(a){a.registerPlainTextFormatter(function(a){return a.replace(/\n([ \t]*\n)+/g,"</p><p>").replace(/\n/g,"<br>")})}}}),c("scribe-plugin-heading-command",[],function(){return function(a){return function(b){var c="<h"+a+">",d="H"+a,e="h"+a,f=new b.api.Command("formatBlock");f.execute=function(){this.queryState()?b.api.Command.prototype.execute.call(this,"<p>"):b.api.Command.prototype.execute.call(this,c)},f.queryState=function(){var a=new b.api.Selection;return!!a.getContaining(function(a){return a.nodeName===d})},f.queryEnabled=function(){var a=new b.api.Selection,c=a.getContaining(function(a){return"OL"===a.nodeName||"UL"===a.nodeName});return b.api.Command.prototype.queryEnabled.apply(this,arguments)&&b.allowsBlockElements()&&!c},b.commands[e]=f}}}),c("scribe-plugin-intelligent-unlink-command",[],function(){return function(){return function(a){var b=new a.api.Command("unlink");b.execute=function(){var b=new a.api.Selection;b.selection.isCollapsed?a.transactionManager.run(function(){var c=b.getContaining(function(a){return"A"===a.nodeName});c&&new a.api.Element(c.parentNode).unwrap(c)}.bind(this)):a.api.Command.prototype.execute.apply(this,arguments)},b.queryEnabled=function(){var b=new a.api.Selection;return b.selection.isCollapsed?!!b.getContaining(function(a){return"A"===a.nodeName}):a.api.Command.prototype.queryEnabled.apply(this,arguments)},a.commands.unlink=b}}}),c("lodash-amd/modern/internals/isNative",[],function(){function a(a){return"function"==typeof a&&d.test(a)}var b=Object.prototype,c=b.toString,d=RegExp("^"+String(c).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$");return a}),c("lodash-amd/modern/internals/objectTypes",[],function(){var a={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1};return a}),c("lodash-amd/modern/objects/isObject",["../internals/objectTypes"],function(a){function b(b){return!(!b||!a[typeof b])}return b}),c("lodash-amd/modern/utilities/noop",[],function(){function a(){}return a}),c("lodash-amd/modern/internals/baseCreate",["./isNative","../objects/isObject","../utilities/noop"],function(a,b){function c(a){return b(a)?d(a):{}}var d=a(d=Object.create)&&d;return d||(c=function(){function a(){}return function(c){if(b(c)){a.prototype=c;var d=new a;a.prototype=null}return d||window.Object()}}()),c}),c("lodash-amd/modern/internals/setBindData",["./isNative","../utilities/noop"],function(a,b){var c={configurable:!1,enumerable:!1,value:null,writable:!1},d=function(){try{var b={},c=a(c=Object.defineProperty)&&c,d=c(b,b,b)&&c}catch(e){}return d}(),e=d?function(a,b){c.value=b,d(a,"__bindData__",c)}:b;return e}),c("lodash-amd/modern/internals/slice",[],function(){function a(a,b,c){b||(b=0),"undefined"==typeof c&&(c=a?a.length:0);for(var d=-1,e=c-b||0,f=Array(0>e?0:e);++d<e;)f[d]=a[b+d];return f}return a}),c("lodash-amd/modern/internals/baseBind",["./baseCreate","../objects/isObject","./setBindData","./slice"],function(a,b,c,d){function e(e){function f(){if(i){var c=d(i);g.apply(c,arguments)}if(this instanceof f){var e=a(h.prototype),k=h.apply(e,c||arguments);return b(k)?k:e}return h.apply(j,c||arguments)}var h=e[0],i=e[2],j=e[4];return c(f,e),f}var f=[],g=f.push;return e}),c("lodash-amd/modern/internals/baseCreateWrapper",["./baseCreate","../objects/isObject","./setBindData","./slice"],function(a,b,c,d){function e(f){function h(){var c=o?m:this;if(k){var f=d(k);g.apply(f,arguments)}if((l||q)&&(f||(f=d(arguments)),l&&g.apply(f,l),q&&f.length<n))return j|=16,e([i,r?j:-4&j,f,null,m,n]);if(f||(f=arguments),p&&(i=c[s]),this instanceof h){c=a(i.prototype);var t=i.apply(c,f);return b(t)?t:c}return i.apply(c,f)}var i=f[0],j=f[1],k=f[2],l=f[3],m=f[4],n=f[5],o=1&j,p=2&j,q=4&j,r=8&j,s=i;return c(h,f),h}var f=[],g=f.push;return e}),c("lodash-amd/modern/objects/isFunction",[],function(){function a(a){return"function"==typeof a}return a}),c("lodash-amd/modern/internals/createWrapper",["./baseBind","./baseCreateWrapper","../objects/isFunction","./slice"],function(a,b,c,d){function e(f,i,j,k,l,m){var n=1&i,o=2&i,p=4&i,q=16&i,r=32&i;if(!o&&!c(f))throw new TypeError;q&&!j.length&&(i&=-17,q=j=!1),r&&!k.length&&(i&=-33,r=k=!1);var s=f&&f.__bindData__;if(s&&s!==!0)return s=d(s),s[2]&&(s[2]=d(s[2])),s[3]&&(s[3]=d(s[3])),!n||1&s[1]||(s[4]=l),!n&&1&s[1]&&(i|=8),!p||4&s[1]||(s[5]=m),q&&g.apply(s[2]||(s[2]=[]),j),r&&h.apply(s[3]||(s[3]=[]),k),s[1]|=i,e.apply(null,s);var t=1==i||17===i?a:b;return t([f,i,j,k,l,m])}var f=[],g=f.push,h=f.unshift;return e}),c("lodash-amd/modern/functions/bind",["../internals/createWrapper","../internals/slice"],function(a,b){function c(c,d){return arguments.length>2?a(c,17,b(arguments,2),null,d):a(c,1,null,null,d)}return c}),c("lodash-amd/modern/utilities/identity",[],function(){function a(a){return a}return a}),c("lodash-amd/modern/support",["./internals/isNative"],function(a){var b=/\bthis\b/,c={};return c.funcDecomp=!a(window.WinRTError)&&b.test(function(){return this}),c.funcNames="string"==typeof Function.name,c}),c("lodash-amd/modern/internals/baseCreateCallback",["../functions/bind","../utilities/identity","./setBindData","../support"],function(a,b,c,d){function e(e,i,j){if("function"!=typeof e)return b;if("undefined"==typeof i||!("prototype"in e))return e;var k=e.__bindData__;if("undefined"==typeof k&&(d.funcNames&&(k=!e.name),k=k||!d.funcDecomp,!k)){var l=h.call(e);d.funcNames||(k=!f.test(l)),k||(k=g.test(l),c(e,k))}if(k===!1||k!==!0&&1&k[1])return e;switch(j){case 1:return function(a){return e.call(i,a)};case 2:return function(a,b){return e.call(i,a,b)};case 3:return function(a,b,c){return e.call(i,a,b,c)};case 4:return function(a,b,c,d){return e.call(i,a,b,c,d)}}return a(e,i)}var f=/^\s*function[ \n\r\t]+\w/,g=/\bthis\b/,h=Function.prototype.toString;return e}),c("lodash-amd/modern/objects/forIn",["../internals/baseCreateCallback","../internals/objectTypes"],function(a,b){var c=function(c,d,e){var f,g=c,h=g;if(!g)return h;if(!b[typeof g])return h;d=d&&"undefined"==typeof e?d:a(d,e,3);for(f in g)if(d(g[f],f,c)===!1)return h;return h};return c}),c("lodash-amd/modern/internals/arrayPool",[],function(){var a=[];return a}),c("lodash-amd/modern/internals/getArray",["./arrayPool"],function(a){function b(){return a.pop()||[]}return b}),c("lodash-amd/modern/internals/maxPoolSize",[],function(){var a=40;return a}),c("lodash-amd/modern/internals/releaseArray",["./arrayPool","./maxPoolSize"],function(a,b){function c(c){c.length=0,a.length<b&&a.push(c)}return c}),c("lodash-amd/modern/internals/baseIsEqual",["../objects/forIn","./getArray","../objects/isFunction","./objectTypes","./releaseArray"],function(a,b,c,d,e){function f(o,r,s,t,u,v){if(s){var w=s(o,r);if("undefined"!=typeof w)return!!w}if(o===r)return 0!==o||1/o==1/r;var x=typeof o,y=typeof r;if(!(o!==o||o&&d[x]||r&&d[y]))return!1;if(null==o||null==r)return o===r;var z=p.call(o),A=p.call(r);if(z==g&&(z=l),A==g&&(A=l),z!=A)return!1;switch(z){case i:case j:return+o==+r;case k:return o!=+o?r!=+r:0==o?1/o==1/r:o==+r;case m:case n:return o==String(r)}var B=z==h;if(!B){var C=q.call(o,"__wrapped__"),D=q.call(r,"__wrapped__");if(C||D)return f(C?o.__wrapped__:o,D?r.__wrapped__:r,s,t,u,v);if(z!=l)return!1;var E=o.constructor,F=r.constructor;if(E!=F&&!(c(E)&&E instanceof E&&c(F)&&F instanceof F)&&"constructor"in o&&"constructor"in r)return!1}var G=!u;u||(u=b()),v||(v=b());for(var H=u.length;H--;)if(u[H]==o)return v[H]==r;var I=0;if(w=!0,u.push(o),v.push(r),B){if(H=o.length,I=r.length,w=I==H,w||t)for(;I--;){var J=H,K=r[I];if(t)for(;J--&&!(w=f(o[J],K,s,t,u,v)););else if(!(w=f(o[I],K,s,t,u,v)))break}}else a(r,function(a,b,c){return q.call(c,b)?(I++,w=q.call(o,b)&&f(o[b],a,s,t,u,v)):void 0}),w&&!t&&a(o,function(a,b,c){return q.call(c,b)?w=--I>-1:void 0});return u.pop(),v.pop(),G&&(e(u),e(v)),w}var g="[object Arguments]",h="[object Array]",i="[object Boolean]",j="[object Date]",k="[object Number]",l="[object Object]",m="[object RegExp]",n="[object String]",o=Object.prototype,p=o.toString,q=o.hasOwnProperty;return f}),c("lodash-amd/modern/internals/shimKeys",["./objectTypes"],function(a){var b=Object.prototype,c=b.hasOwnProperty,d=function(b){var d,e=b,f=[];if(!e)return f;if(!a[typeof b])return f;for(d in e)c.call(e,d)&&f.push(d);return f};return d}),c("lodash-amd/modern/objects/keys",["../internals/isNative","./isObject","../internals/shimKeys"],function(a,b,c){var d=a(d=Object.keys)&&d,e=d?function(a){return b(a)?d(a):[]}:c;return e}),c("lodash-amd/modern/utilities/property",[],function(){function a(a){return function(b){return b[a]}}return a}),c("lodash-amd/modern/functions/createCallback",["../internals/baseCreateCallback","../internals/baseIsEqual","../objects/isObject","../objects/keys","../utilities/property"],function(a,b,c,d,e){function f(f,g,h){var i=typeof f;if(null==f||"function"==i)return a(f,g,h);if("object"!=i)return e(f);var j=d(f),k=j[0],l=f[k];return 1!=j.length||l!==l||c(l)?function(a){for(var c=j.length,d=!1;c--&&(d=b(a[j[c]],f[j[c]],null,!0)););return d}:function(a){var b=a[k];return l===b&&(0!==l||1/l==1/b)}}return f}),c("lodash-amd/modern/objects/forOwn",["../internals/baseCreateCallback","./keys","../internals/objectTypes"],function(a,b,c){var d=function(d,e,f){var g,h=d,i=h;if(!h)return i;if(!c[typeof h])return i;e=e&&"undefined"==typeof f?e:a(e,f,3);for(var j=-1,k=c[typeof h]&&b(h),l=k?k.length:0;++j<l;)if(g=k[j],e(h[g],g,d)===!1)return i;return i};return d}),c("lodash-amd/modern/objects/findKey",["../functions/createCallback","./forOwn"],function(a,b){function c(c,d,e){var f;return d=a(d,e,3),b(c,function(a,b,c){return d(a,b,c)?(f=b,!1):void 0}),f}return c}),c("scribe-plugin-keyboard-shortcuts",["lodash-amd/modern/objects/findKey"],function(a){return function(b){return function(c){c.el.addEventListener("keydown",function(d){var e=a(b,function(a){return a(d)});if(e){var f=c.getCommand(e);d.preventDefault(),f.queryEnabled()&&f.execute()}})}}}),c("scribe-plugin-link-ui",[],function(){return function(a){return function(b){function c(){var a=l.val();d(a)?(clearTimeout(p),p=setTimeout(o,200,a,n),n.show()):n.hide()}function d(a){return a.indexOf(".")>-1||a.indexOf("/")>-1||a.indexOf("www")>-1||a.indexOf("http://")>-1||a.indexOf("https://")>-1||""===a?!1:!0}function e(a){c(),k.show(),a.addClass("link-edit"),setTimeout(function(){$("body, .link-tools .close").bind("click",f),l.val(a.attr("href").replace(m,"")),l[0].focus()},10)}function f(a){0===$(a.target).closest(".link-tools").length&&g()}function g(){b.updateContents(function(){var a=l.val();""===a?h():$(".link-edit, [href="+m+"]").attr("href",a).removeClass("link-edit")},!1),$("body, .link-tools .close").unbind("click"),k.hide()}function h(){var a=$(".link-edit, [href*="+m+"]");a[0].outerHTML=a[0].innerHTML}var i=b.el.parentNode,j=new b.api.Command("createLink"),k=$(".link-tools",i),l=$(".link-tools input",i),m="#replaceme",n=$(".search-results",k),o=a.searchHandler||function(){};j.nodeName="A",j.execute=function(){var a=this,c=new b.api.Selection;c.range.collapsed||(b._skipFormatters=!0,b.api.SimpleCommand.prototype.execute.call(a,m),e($("a[href*="+m+"]")))},$(".remove",k).click(function(){l.val(""),g()}),$(".ok",k).click(g),n.click(function(a){var b=$(a.target).closest("a");1===b.length&&(a.preventDefault(),l.val(b.attr("href")),c())}),l.bind("keyup",c).bind("keydown",function(a){(13===a.keyCode||27===a.keyCode)&&g()}),b.el.addEventListener("click",function(a){var c=(new b.api.Selection,$(a.target).closest("a"));1===c.length&&(e(c),a.preventDefault())});var p;j.queryState=function(){var a=new b.api.Selection;return!!a.getContaining(function(a){return a.nodeName===this.nodeName}.bind(this))},b.commands.linkUI=j}}}),function(a,b){"function"==typeof c&&c.amd?c("html-janitor",b):a.amdWeb=b()}(this,function(){function a(a){this.config=a}function b(a){return-1!==e.indexOf(a.nodeName)}function c(a){return-1!==f.indexOf(a.nodeName)}function d(a){return document.createTreeWalker(a,NodeFilter.SHOW_TEXT|NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_COMMENT)}var e=["P","LI","DIV"],f=["A","B","DEL","I","U"];return a.prototype.clean=function(a){var b=document.createElement("div");return b.innerHTML=a,this._sanitize(b),b.innerHTML},a.prototype._sanitize=function(a){var e=d(a),f=e.firstChild();if(f)do{var g=f.nodeName.toLowerCase(),h=this.config.tags[g];if(!f._sanitized){if(this.config.skipSanitization(f))return;if(f.nodeType!==Node.TEXT_NODE){if(f.nodeType===Node.COMMENT_NODE){a.removeChild(f),this._sanitize(a);break}var i,j=c(f);j&&(i=Array.prototype.some.call(f.childNodes,b));var k=j&&i,l=!!a.parentNode,m=b(a)&&b(f)&&l;if(!this.config.tags[g]||k||m){if("SCRIPT"!==f.nodeName&&"STYLE"!==f.nodeName)for(;f.childNodes.length>0;)a.insertBefore(f.childNodes[0],f);a.removeChild(f),this._sanitize(a);break}for(var n=0;n<f.attributes.length;n+=1){var o=f.attributes[n],p=o.name.toLowerCase(),q=h[p],r=!q,s=q!==!0&&o.value!==q;(r||s)&&(f.removeAttribute(o.name),n-=1)}this._sanitize(f),f._sanitized=!0}else if(""===f.data.trim()&&(f.previousElementSibling&&b(f.previousElementSibling)||f.nextElementSibling&&b(f.nextElementSibling))){a.removeChild(f),this._sanitize(a);break}}}while(f=e.nextSibling())},a}),c("lodash-amd/modern/internals/isNative",[],function(){function a(a){return"function"==typeof a&&d.test(a)}var b=Object.prototype,c=b.toString,d=RegExp("^"+String(c).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$");return a}),c("lodash-amd/modern/internals/objectTypes",[],function(){var a={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1};return a}),c("lodash-amd/modern/objects/isObject",["../internals/objectTypes"],function(a){function b(b){return!(!b||!a[typeof b])}return b}),c("lodash-amd/modern/utilities/noop",[],function(){function a(){}return a}),c("lodash-amd/modern/internals/baseCreate",["./isNative","../objects/isObject","../utilities/noop"],function(a,b){function c(a){return b(a)?d(a):{}}var d=a(d=Object.create)&&d;return d||(c=function(){function a(){}return function(c){if(b(c)){a.prototype=c;var d=new a;a.prototype=null}return d||window.Object()}}()),c}),c("lodash-amd/modern/internals/setBindData",["./isNative","../utilities/noop"],function(a,b){var c={configurable:!1,enumerable:!1,value:null,writable:!1},d=function(){try{var b={},c=a(c=Object.defineProperty)&&c,d=c(b,b,b)&&c}catch(e){}return d}(),e=d?function(a,b){c.value=b,d(a,"__bindData__",c)}:b;return e}),c("lodash-amd/modern/internals/slice",[],function(){function a(a,b,c){b||(b=0),"undefined"==typeof c&&(c=a?a.length:0);for(var d=-1,e=c-b||0,f=Array(0>e?0:e);++d<e;)f[d]=a[b+d];return f}return a}),c("lodash-amd/modern/internals/baseBind",["./baseCreate","../objects/isObject","./setBindData","./slice"],function(a,b,c,d){function e(e){function f(){if(i){var c=d(i);g.apply(c,arguments)}if(this instanceof f){var e=a(h.prototype),k=h.apply(e,c||arguments);return b(k)?k:e}return h.apply(j,c||arguments)}var h=e[0],i=e[2],j=e[4];return c(f,e),f}var f=[],g=f.push;return e}),c("lodash-amd/modern/internals/baseCreateWrapper",["./baseCreate","../objects/isObject","./setBindData","./slice"],function(a,b,c,d){function e(f){function h(){var c=o?m:this;if(k){var f=d(k);g.apply(f,arguments)}if((l||q)&&(f||(f=d(arguments)),l&&g.apply(f,l),q&&f.length<n))return j|=16,e([i,r?j:-4&j,f,null,m,n]);if(f||(f=arguments),p&&(i=c[s]),this instanceof h){c=a(i.prototype);var t=i.apply(c,f);return b(t)?t:c}return i.apply(c,f)}var i=f[0],j=f[1],k=f[2],l=f[3],m=f[4],n=f[5],o=1&j,p=2&j,q=4&j,r=8&j,s=i;return c(h,f),h}var f=[],g=f.push;return e}),c("lodash-amd/modern/objects/isFunction",[],function(){function a(a){return"function"==typeof a}return a}),c("lodash-amd/modern/internals/createWrapper",["./baseBind","./baseCreateWrapper","../objects/isFunction","./slice"],function(a,b,c,d){function e(f,i,j,k,l,m){var n=1&i,o=2&i,p=4&i,q=16&i,r=32&i;if(!o&&!c(f))throw new TypeError;q&&!j.length&&(i&=-17,q=j=!1),r&&!k.length&&(i&=-33,r=k=!1);var s=f&&f.__bindData__;if(s&&s!==!0)return s=d(s),s[2]&&(s[2]=d(s[2])),s[3]&&(s[3]=d(s[3])),!n||1&s[1]||(s[4]=l),!n&&1&s[1]&&(i|=8),!p||4&s[1]||(s[5]=m),q&&g.apply(s[2]||(s[2]=[]),j),r&&h.apply(s[3]||(s[3]=[]),k),s[1]|=i,e.apply(null,s);var t=1==i||17===i?a:b;return t([f,i,j,k,l,m])}var f=[],g=f.push,h=f.unshift;return e}),c("lodash-amd/modern/functions/bind",["../internals/createWrapper","../internals/slice"],function(a,b){function c(c,d){return arguments.length>2?a(c,17,b(arguments,2),null,d):a(c,1,null,null,d)}return c}),c("lodash-amd/modern/utilities/identity",[],function(){function a(a){return a}return a}),c("lodash-amd/modern/support",["./internals/isNative"],function(a){var b=/\bthis\b/,c={};return c.funcDecomp=!a(window.WinRTError)&&b.test(function(){return this}),c.funcNames="string"==typeof Function.name,c}),c("lodash-amd/modern/internals/baseCreateCallback",["../functions/bind","../utilities/identity","./setBindData","../support"],function(a,b,c,d){function e(e,i,j){if("function"!=typeof e)return b;if("undefined"==typeof i||!("prototype"in e))return e;var k=e.__bindData__;if("undefined"==typeof k&&(d.funcNames&&(k=!e.name),k=k||!d.funcDecomp,!k)){var l=h.call(e);d.funcNames||(k=!f.test(l)),k||(k=g.test(l),c(e,k))}if(k===!1||k!==!0&&1&k[1])return e;switch(j){case 1:return function(a){return e.call(i,a)};case 2:return function(a,b){return e.call(i,a,b)};case 3:return function(a,b,c){return e.call(i,a,b,c)};case 4:return function(a,b,c,d){return e.call(i,a,b,c,d)}}return a(e,i)}var f=/^\s*function[ \n\r\t]+\w/,g=/\bthis\b/,h=Function.prototype.toString;return e}),c("lodash-amd/modern/internals/shimKeys",["./objectTypes"],function(a){var b=Object.prototype,c=b.hasOwnProperty,d=function(b){var d,e=b,f=[];if(!e)return f;if(!a[typeof b])return f;for(d in e)c.call(e,d)&&f.push(d);return f};return d}),c("lodash-amd/modern/objects/keys",["../internals/isNative","./isObject","../internals/shimKeys"],function(a,b,c){var d=a(d=Object.keys)&&d,e=d?function(a){return b(a)?d(a):[]}:c;return e}),c("lodash-amd/modern/objects/forOwn",["../internals/baseCreateCallback","./keys","../internals/objectTypes"],function(a,b,c){var d=function(d,e,f){var g,h=d,i=h;if(!h)return i;if(!c[typeof h])return i;e=e&&"undefined"==typeof f?e:a(e,f,3);for(var j=-1,k=c[typeof h]&&b(h),l=k?k.length:0;++j<l;)if(g=k[j],e(h[g],g,d)===!1)return i;return i};return d}),c("lodash-amd/modern/collections/forEach",["../internals/baseCreateCallback","../objects/forOwn"],function(a,b){function c(c,d,e){var f=-1,g=c?c.length:0;if(d=d&&"undefined"==typeof e?d:a(d,e,3),"number"==typeof g)for(;++f<g&&d(c[f],f,c)!==!1;);else b(c,d);return c}return c}),c("lodash-amd/modern/objects/isArray",["../internals/isNative"],function(a){var b="[object Array]",c=Object.prototype,d=c.toString,e=a(e=Array.isArray)&&e,f=e||function(a){return a&&"object"==typeof a&&"number"==typeof a.length&&d.call(a)==b||!1};return f}),c("lodash-amd/modern/objects/forIn",["../internals/baseCreateCallback","../internals/objectTypes"],function(a,b){var c=function(c,d,e){var f,g=c,h=g;if(!g)return h;if(!b[typeof g])return h;d=d&&"undefined"==typeof e?d:a(d,e,3);for(f in g)if(d(g[f],f,c)===!1)return h;return h};return c}),c("lodash-amd/modern/internals/shimIsPlainObject",["../objects/forIn","../objects/isFunction"],function(a,b){function c(c){var e,h;return c&&f.call(c)==d&&(e=c.constructor,!b(e)||e instanceof e)?(a(c,function(a,b){h=b}),"undefined"==typeof h||g.call(c,h)):!1}var d="[object Object]",e=Object.prototype,f=e.toString,g=e.hasOwnProperty;return c}),c("lodash-amd/modern/objects/isPlainObject",["../internals/isNative","../internals/shimIsPlainObject"],function(a,b){var c="[object Object]",d=Object.prototype,e=d.toString,f=a(f=Object.getPrototypeOf)&&f,g=f?function(d){if(!d||e.call(d)!=c)return!1;var g=d.valueOf,h=a(g)&&(h=f(g))&&f(h);return h?d==h||f(d)==h:b(d)}:b;return g}),c("lodash-amd/modern/internals/baseMerge",["../collections/forEach","../objects/forOwn","../objects/isArray","../objects/isPlainObject"],function(a,b,c,d){function e(f,g,h,i,j){(c(g)?a:b)(g,function(a,b){var g,k,l=a,m=f[b];if(a&&((k=c(a))||d(a))){for(var n=i.length;n--;)if(g=i[n]==a){m=j[n];break}if(!g){var o;h&&(l=h(m,a),(o="undefined"!=typeof l)&&(m=l)),o||(m=k?c(m)?m:[]:d(m)?m:{}),i.push(a),j.push(m),o||e(m,a,h,i,j)}}else h&&(l=h(m,a),"undefined"==typeof l&&(l=a)),"undefined"!=typeof l&&(m=l);f[b]=m})}return e}),c("lodash-amd/modern/internals/arrayPool",[],function(){var a=[];return a}),c("lodash-amd/modern/internals/getArray",["./arrayPool"],function(a){function b(){return a.pop()||[]}return b}),c("lodash-amd/modern/internals/maxPoolSize",[],function(){var a=40;return a}),c("lodash-amd/modern/internals/releaseArray",["./arrayPool","./maxPoolSize"],function(a,b){function c(c){c.length=0,a.length<b&&a.push(c)}return c}),c("lodash-amd/modern/objects/merge",["../internals/baseCreateCallback","../internals/baseMerge","../internals/getArray","./isObject","../internals/releaseArray","../internals/slice"],function(a,b,c,d,e,f){function g(g){var h=arguments,i=2;if(!d(g))return g;if("number"!=typeof h[2]&&(i=h.length),i>3&&"function"==typeof h[i-2])var j=a(h[--i-1],h[i--],2);else i>2&&"function"==typeof h[i-1]&&(j=h[--i]);for(var k=f(arguments,1,i),l=-1,m=c(),n=c();++l<i;)b(g,k[l],j,m,n);return e(m),e(n),g
}return g}),c("lodash-amd/modern/objects/assign",["../internals/baseCreateCallback","./keys","../internals/objectTypes"],function(a,b,c){var d=function(d,e,f){var g,h=d,i=h;if(!h)return i;var j=arguments,k=0,l="number"==typeof f?2:j.length;if(l>3&&"function"==typeof j[l-2])var m=a(j[--l-1],j[l--],2);else l>2&&"function"==typeof j[l-1]&&(m=j[--l]);for(;++k<l;)if(h=j[k],h&&c[typeof h])for(var n=-1,o=c[typeof h]&&b(h),p=o?o.length:0;++n<p;)g=o[n],i[g]=m?m(i[g],h[g]):h[g];return i};return d}),c("lodash-amd/modern/internals/baseClone",["../objects/assign","../collections/forEach","../objects/forOwn","./getArray","../objects/isArray","../objects/isObject","./releaseArray","./slice"],function(a,b,c,d,e,f,g,h){function i(k,l,o,q,u){if(o){var y=o(k);if("undefined"!=typeof y)return y}var z=f(k);if(!z)return k;var A=v.call(k);if(!t[A])return k;var B=x[A];switch(A){case m:case n:return new B(+k);case p:case s:return new B(k);case r:return y=B(k.source,j.exec(k)),y.lastIndex=k.lastIndex,y}var C=e(k);if(l){var D=!q;q||(q=d()),u||(u=d());for(var E=q.length;E--;)if(q[E]==k)return u[E];y=C?B(k.length):{}}else y=C?h(k):a({},k);return C&&(w.call(k,"index")&&(y.index=k.index),w.call(k,"input")&&(y.input=k.input)),l?(q.push(k),u.push(y),(C?b:c)(k,function(a,b){y[b]=i(a,l,o,q,u)}),D&&(g(q),g(u)),y):y}var j=/\w*$/,k="[object Arguments]",l="[object Array]",m="[object Boolean]",n="[object Date]",o="[object Function]",p="[object Number]",q="[object Object]",r="[object RegExp]",s="[object String]",t={};t[o]=!1,t[k]=t[l]=t[m]=t[n]=t[p]=t[q]=t[r]=t[s]=!0;var u=Object.prototype,v=u.toString,w=u.hasOwnProperty,x={};return x[l]=Array,x[m]=Boolean,x[n]=Date,x[o]=Function,x[q]=Object,x[p]=Number,x[r]=RegExp,x[s]=String,i}),c("lodash-amd/modern/objects/cloneDeep",["../internals/baseClone","../internals/baseCreateCallback"],function(a,b){function c(c,d,e){return a(c,!0,"function"==typeof d&&b(d,e,1))}return c}),c("scribe-plugin-sanitizer",["html-janitor","lodash-amd/modern/objects/merge","lodash-amd/modern/objects/cloneDeep"],function(a,b,c){return function(d){var e=b(c(d),{tags:{em:{"class":"scribe-marker"}}});return function(b){var c=new a(e);b.registerHTMLFormatter("sanitize",c.clean.bind(c))}}}),c("lodash-amd/modern/internals/baseIndexOf",[],function(){function a(a,b,c){for(var d=(c||0)-1,e=a?a.length:0;++d<e;)if(a[d]===b)return d;return-1}return a}),c("lodash-amd/modern/internals/isNative",[],function(){function a(a){return"function"==typeof a&&d.test(a)}var b=Object.prototype,c=b.toString,d=RegExp("^"+String(c).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$");return a}),c("lodash-amd/modern/internals/objectTypes",[],function(){var a={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1};return a}),c("lodash-amd/modern/objects/isObject",["../internals/objectTypes"],function(a){function b(b){return!(!b||!a[typeof b])}return b}),c("lodash-amd/modern/utilities/noop",[],function(){function a(){}return a}),c("lodash-amd/modern/internals/baseCreate",["./isNative","../objects/isObject","../utilities/noop"],function(a,b){function c(a){return b(a)?d(a):{}}var d=a(d=Object.create)&&d;return d||(c=function(){function a(){}return function(c){if(b(c)){a.prototype=c;var d=new a;a.prototype=null}return d||window.Object()}}()),c}),c("lodash-amd/modern/internals/setBindData",["./isNative","../utilities/noop"],function(a,b){var c={configurable:!1,enumerable:!1,value:null,writable:!1},d=function(){try{var b={},c=a(c=Object.defineProperty)&&c,d=c(b,b,b)&&c}catch(e){}return d}(),e=d?function(a,b){c.value=b,d(a,"__bindData__",c)}:b;return e}),c("lodash-amd/modern/internals/slice",[],function(){function a(a,b,c){b||(b=0),"undefined"==typeof c&&(c=a?a.length:0);for(var d=-1,e=c-b||0,f=Array(0>e?0:e);++d<e;)f[d]=a[b+d];return f}return a}),c("lodash-amd/modern/internals/baseBind",["./baseCreate","../objects/isObject","./setBindData","./slice"],function(a,b,c,d){function e(e){function f(){if(i){var c=d(i);g.apply(c,arguments)}if(this instanceof f){var e=a(h.prototype),k=h.apply(e,c||arguments);return b(k)?k:e}return h.apply(j,c||arguments)}var h=e[0],i=e[2],j=e[4];return c(f,e),f}var f=[],g=f.push;return e}),c("lodash-amd/modern/internals/baseCreateWrapper",["./baseCreate","../objects/isObject","./setBindData","./slice"],function(a,b,c,d){function e(f){function h(){var c=o?m:this;if(k){var f=d(k);g.apply(f,arguments)}if((l||q)&&(f||(f=d(arguments)),l&&g.apply(f,l),q&&f.length<n))return j|=16,e([i,r?j:-4&j,f,null,m,n]);if(f||(f=arguments),p&&(i=c[s]),this instanceof h){c=a(i.prototype);var t=i.apply(c,f);return b(t)?t:c}return i.apply(c,f)}var i=f[0],j=f[1],k=f[2],l=f[3],m=f[4],n=f[5],o=1&j,p=2&j,q=4&j,r=8&j,s=i;return c(h,f),h}var f=[],g=f.push;return e}),c("lodash-amd/modern/objects/isFunction",[],function(){function a(a){return"function"==typeof a}return a}),c("lodash-amd/modern/internals/createWrapper",["./baseBind","./baseCreateWrapper","../objects/isFunction","./slice"],function(a,b,c,d){function e(f,i,j,k,l,m){var n=1&i,o=2&i,p=4&i,q=16&i,r=32&i;if(!o&&!c(f))throw new TypeError;q&&!j.length&&(i&=-17,q=j=!1),r&&!k.length&&(i&=-33,r=k=!1);var s=f&&f.__bindData__;if(s&&s!==!0)return s=d(s),s[2]&&(s[2]=d(s[2])),s[3]&&(s[3]=d(s[3])),!n||1&s[1]||(s[4]=l),!n&&1&s[1]&&(i|=8),!p||4&s[1]||(s[5]=m),q&&g.apply(s[2]||(s[2]=[]),j),r&&h.apply(s[3]||(s[3]=[]),k),s[1]|=i,e.apply(null,s);var t=1==i||17===i?a:b;return t([f,i,j,k,l,m])}var f=[],g=f.push,h=f.unshift;return e}),c("lodash-amd/modern/functions/bind",["../internals/createWrapper","../internals/slice"],function(a,b){function c(c,d){return arguments.length>2?a(c,17,b(arguments,2),null,d):a(c,1,null,null,d)}return c}),c("lodash-amd/modern/utilities/identity",[],function(){function a(a){return a}return a}),c("lodash-amd/modern/support",["./internals/isNative"],function(a){var b=/\bthis\b/,c={};return c.funcDecomp=!a(window.WinRTError)&&b.test(function(){return this}),c.funcNames="string"==typeof Function.name,c}),c("lodash-amd/modern/internals/baseCreateCallback",["../functions/bind","../utilities/identity","./setBindData","../support"],function(a,b,c,d){function e(e,i,j){if("function"!=typeof e)return b;if("undefined"==typeof i||!("prototype"in e))return e;var k=e.__bindData__;if("undefined"==typeof k&&(d.funcNames&&(k=!e.name),k=k||!d.funcDecomp,!k)){var l=h.call(e);d.funcNames||(k=!f.test(l)),k||(k=g.test(l),c(e,k))}if(k===!1||k!==!0&&1&k[1])return e;switch(j){case 1:return function(a){return e.call(i,a)};case 2:return function(a,b){return e.call(i,a,b)};case 3:return function(a,b,c){return e.call(i,a,b,c)};case 4:return function(a,b,c,d){return e.call(i,a,b,c,d)}}return a(e,i)}var f=/^\s*function[ \n\r\t]+\w/,g=/\bthis\b/,h=Function.prototype.toString;return e}),c("lodash-amd/modern/internals/shimKeys",["./objectTypes"],function(a){var b=Object.prototype,c=b.hasOwnProperty,d=function(b){var d,e=b,f=[];if(!e)return f;if(!a[typeof b])return f;for(d in e)c.call(e,d)&&f.push(d);return f};return d}),c("lodash-amd/modern/objects/keys",["../internals/isNative","./isObject","../internals/shimKeys"],function(a,b,c){var d=a(d=Object.keys)&&d,e=d?function(a){return b(a)?d(a):[]}:c;return e}),c("lodash-amd/modern/objects/forOwn",["../internals/baseCreateCallback","./keys","../internals/objectTypes"],function(a,b,c){var d=function(d,e,f){var g,h=d,i=h;if(!h)return i;if(!c[typeof h])return i;e=e&&"undefined"==typeof f?e:a(e,f,3);for(var j=-1,k=c[typeof h]&&b(h),l=k?k.length:0;++j<l;)if(g=k[j],e(h[g],g,d)===!1)return i;return i};return d}),c("lodash-amd/modern/objects/isArray",["../internals/isNative"],function(a){var b="[object Array]",c=Object.prototype,d=c.toString,e=a(e=Array.isArray)&&e,f=e||function(a){return a&&"object"==typeof a&&"number"==typeof a.length&&d.call(a)==b||!1};return f}),c("lodash-amd/modern/objects/isString",[],function(){function a(a){return"string"==typeof a||a&&"object"==typeof a&&d.call(a)==b||!1}var b="[object String]",c=Object.prototype,d=c.toString;return a}),c("lodash-amd/modern/collections/contains",["../internals/baseIndexOf","../objects/forOwn","../objects/isArray","../objects/isString"],function(a,b,c,d){function e(e,g,h){var i=-1,j=a,k=e?e.length:0,l=!1;return h=(0>h?f(0,k+h):h)||0,c(e)?l=j(e,g,h)>-1:"number"==typeof k?l=(d(e)?e.indexOf(g,h):j(e,g,h))>-1:b(e,function(a){return++i>=h?!(l=a===g):void 0}),l}var f=Math.max;return e}),c("scribe-common/src/element",["lodash-amd/modern/collections/contains"],function(a){function b(b){return a(e,b.nodeName)}function c(a){return a.nodeType===Node.ELEMENT_NODE&&"scribe-marker"===a.className}function d(a,b){for(;b.childNodes.length>0;)a.insertBefore(b.childNodes[0],b);a.removeChild(b)}var e=["P","LI","DIV","BLOCKQUOTE","UL","OL","H1","H2","H3","H4","H5","H6"];return{isBlockElement:b,isSelectionMarkerNode:c,unwrap:d}}),c("scribe-plugin-smart-lists",["scribe-common/src/element"],function(a){return function(){function b(a){return"*"===a||"-"===a||"•"===a}function c(b){for(;b&&!a.isBlockElement(b);)b=b.parentNode;return b}var d={32:"Space",42:"*",45:"-",46:".",49:"1",8226:"•"};return function(a){function e(){var b,c=new a.api.Selection,d=c.selection.anchorNode;if(d.nodeType===Node.TEXT_NODE?b=d:d.firstChild.nodeType===Node.TEXT_NODE&&(b=d.firstChild),!b)throw new Error("Cannot empty non-text node!");var e=b.parentNode;b.previousSibling&&e.removeChild(b.previousSibling),e.removeChild(b)}function f(f){var j;g=h,h=i,i=d[f.charCode];var k=new a.api.Selection,l=k.range.commonAncestorContainer,m=c(l);if(m&&"P"===m.tagName){var n=b(l.textContent[0]);b(h)&&"Space"===i&&n&&(j="insertUnorderedList");var o="1."===[l.previousSibling&&l.previousSibling.textContent,l.textContent].join("").slice(0,2);"1"===g&&"."===h&&"Space"===i&&o&&(j="insertOrderedList")}j&&(f.preventDefault(),a.transactionManager.run(function(){a.getCommand(j).execute(),e()}))}var g,h,i;a.el.addEventListener("keypress",f)}}}),c("scribe-plugin-toolbar",[],function(){return function(a){return function(b){var c=a.querySelectorAll("[data-command-name]");Array.prototype.forEach.call(c,function(a){function c(){var c=b.getCommand(a.dataset.commandName),d=new b.api.Selection;d.range&&c.queryState(a.dataset.commandValue)?a.classList.add("active"):a.classList.remove("active"),d.range&&c.queryEnabled()?a.removeAttribute("disabled"):a.setAttribute("disabled","disabled")}a.addEventListener("click",function(){var c=b.getCommand(a.dataset.commandName);b.el.focus(),c.execute(a.dataset.commandValue)}),b.el.addEventListener("keyup",c),b.el.addEventListener("mouseup",c),b.el.addEventListener("focus",c),b.el.addEventListener("blur",c),b.on("content-changed",c)})}}}),c("scribe-plugin-inline-objects",[],function(){return function(a){return function(b){function c(a){n=a,$(".embed-button",q).click(d),$(".inline-tools button",q.parentNode).click(function(a){var b=$(a.target).data("commandName");"function"==typeof r[b]&&r[b]()})}function d(a){var c,d,g=$(".embed-fly-out").height(),h=$(".embed-button").height(),i=$(a.target).closest("button").data("commandName");"embed-before"===i?(c=o.position().top-g/2+h/2,d="before"):(c=o.position().top+o.height()+parseInt(o.css("margin-top"))-g/2+h/2,d="after"),$(".embed-fly-out",q).css({top:c,left:$(b.el).css("padding-left")}).show();var j=o;$(".embed-fly-out button").bind("click.inline",function(a){var b=$(a.target).closest("button").data("commandName");f(b,j,d)}),$("body").bind("click.inline",function(a){0===$(a.target).closest(".embed-tools").length&&e()})}function e(){$("body").unbind("click.inline"),$(".embed-fly-out button").unbind("click.inline"),$(".embed-fly-out").hide()}function f(a,c,d){b.trigger("inline:insert:"+a,[function(e){b.updateContents(function(){var b=m(n[a].template,$.extend(n[a].defaults,e));$(c)[d](b),$(".inline",q).attr("contenteditable","false")})}]),$(".embed-tools",q).removeClass("active")}function g(){$(".inline-tools").hide(),$(q).removeClass("inline-active")}function h(){var a=$(p),b=a.position();$(q).addClass("inline-active"),$(".inline-tools").attr("data-type",a.attr("data-type")),$(".inline-tools .size",q).html($(p).attr("data-size")),$(".inline-tools .crop",q).html($(p).attr("data-crop")),$(".inline-tools",q).css({top:b.top+parseInt(a.css("margin-top")),left:b.left+parseInt(a.css("margin-left"))+parseInt($(".editor",q).css("margin-left")),width:a.width(),height:a.height()}).show()}function i(){return n[$(p).attr("data-type")].size}function j(){return n[$(p).attr("data-type")].crop}function k(a,b){var c=$(p).attr("data-"+a),d=b.indexOf(c)+1;d>=b.length&&(d=0),l(a,b[d]),"function"==typeof window.picturefill&&setTimeout(function(){window.picturefill(p)},100)}function l(a,c){var d=$(p).attr("data-"+a);b.updateContents(function(){$(p).removeClass(a+"-"+d).addClass(a+"-"+c).attr("data-"+a,c),h()})}function m(a,b){for(var c in b)c&&(a=a.replace(new RegExp("{{"+c+"}}","g"),b[c]));return a}var n,o,p,q=b.el.parentNode;b.el.addEventListener("mouseover",function(a){var c=$(a.target).closest(".editor>*");1===c.length?($(".embed-tools",q).css({width:$(b.el).css("padding-left"),top:c.position().top+c.css("margin-top").replace(/[^-\d\.]/g,"")/2,height:c.height()}).addClass("active"),o=c):$(".embed-tools",q).removeClass("active")}),b.el.parentNode.addEventListener("mouseleave",function(){g(),$(".embed-tools",q).removeClass("active")}),$(".embed-tools",q).mouseover(function(){$(".embed-tools",q).addClass("active")}),$(".editor",q).mouseover(function(a){var b=$(a.target).parents(".inline");1===b.length?(p=b[b.length-1],h()):g()});var r={inline_caption:function(){var a=prompt("Caption",$(".caption",p).html());(a||""===a)&&b.updateContents(function(){$(".caption",p).html(a)})},inline_size:function(){var a=i();k("size",a);var b=$(p).attr("data-crop"),c=j();-1===c.indexOf(b)&&l("crop",c[0])},inline_crop:function(){var a=n[$(p).attr("data-type")].crop;k("crop",a)},inline_up:function(){g();var a=$(p).prev()[0];if(a){var c=$(p).offset().top;b.updateContents(function(){$(p).after(a),setTimeout(function(){h();var a=$(p).offset().top;window.scrollBy(0,a-c)},0)})}},inline_down:function(){g();var a=$(p).next()[0];if(a){var c=$(p).offset().top;b.updateContents(function(){$(p).before(a),setTimeout(function(){h();var a=$(p).offset().top;window.scrollBy(0,a-c)},0)})}},inline_remove:function(){b.updateContents(function(){$(p).remove()}),g()},inline_edit:function(){b.trigger("inline:edit:"+$(p).attr("data-type"),[p,function(a,c){var d=$(a).attr("data-type");b.updateContents(function(){a.outerHTML=m(n[d].template,$.extend(n[d].defaults,c))})}])}};"string"==typeof a||a instanceof String?$.ajax(a,{success:c,dataType:"json"}):c(a)}}}),c("scribe-plugin-betty-cropper",[],function(){return function(a){return function(b){function c(b){a.insertDialog().then(function(a){var c;c=-1!==a.name.toUpperCase().indexOf("GIF")?"gif":"jpg",b({image_id:a.id,format:c}),window.picturefill&&setTimeout(function(){window.picturefill($("[data-image-id="+a.id+"]")[0])},100)},function(a){console.log(a)},function(a){console.log(a)})}function d(b){e=b.getAttribute("data-image-id");var c=$(".caption",b).html(),d=b.getAttribute("data-alt");a.editDialog({id:e,caption:c,alt:d}).then(function(a){null===a.id?$(b).remove():($(b).attr("data-image-id",a.id),$(b).attr("data-alt",a.alt),$(".caption",b).html(a.caption),window.picturefill&&setTimeout(function(){window.picturefill($("[data-image-id="+a.id+"]")[0])},100))})}var e;b.on("inline:edit:image",d),b.on("inline:insert:image",c)}}}),c("scribe-plugin-youtube",[],function(){return function(){return function(a){function b(a){if(!a)return!1;var b=/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/,c=a.match(b);return c&&11==c[7].length?c[7]:!1}function c(a){var c=prompt("Youtube URL:"),d=b(c);d&&a({youtube_id:d,caption:""})}function d(a,c){var d=prompt("Youtube URL:",$(a).attr("data-youtube-id")||""),e=b(d);e&&c(a,{youtube_id:e,caption:$(".caption",a).html()})}a.on("inline:insert:youtube",c),a.on("inline:edit:youtube",d)}}}),c("scribe-plugin-embed",[],function(){return function(){return function(a){function b(a,b){h.val(unescape($(a).attr("data-code"))),i.val($(".caption",a).text());var c=$(a).attr("data-size")+"-"+$(a).attr("data-crop");$("[value="+c+"]",g).attr("checked",!0),g.modal("show"),j.click(function(){var c=h.val();""===c.trim()?k.show():(k.hide(),b(a,{code:c,caption:i.val(),escaped_code:escape(c),size:d(),crop:e()}),g.modal("hide"))}),g.modal("show")}function c(a){h.val(""),i.val(""),g.modal("show"),j.click(function(){var b=h.val();""===b.trim()?k.show():(k.hide(),a({code:b,caption:i.val(),escaped_code:escape(b),size:d(),crop:e()}),g.modal("hide"))})}function d(){var a="original";return l.length>0&&l.val().split("-")[0],a}function e(){var a="original";return l.length>0&&l.val().split("-")[1],a}a.on("inline:insert:embed",c),a.on("inline:edit:embed",b);var f=a.el.parentNode,g=$(".embed-modal",f),h=$(".embed-body",g),i=$(".embed-caption",g),j=$(".set-embed-button",g),k=$(".embed-error",g),l=$("[name=size]",g);g.on("hide.bs.modal",function(){j.unbind("click"),k.hide()})}}}),c("scribe-plugin-onion-video",[],function(){return function(a){return function(b){function c(c){function d(){}function e(){}return a.insertDialog().then(function(d){b.updateContents(function(){c({embed_url:a.videoEmbedUrl,video_id:d.attrs.id})})},function(a){e(a)},function(a){d(a)})}function d(b){var c=$(b).attr("data-video-id")||$(b).attr("data-videoid");a.editDialog(c)}b.on("inline:edit:onion-video",d),b.on("inline:insert:onion-video",c)}}}),c("scribe-plugin-hr",[],function(){return function(){return function(a){function b(a){a({})}a.on("inline:insert:hr",b)}}}),c("scribe-plugin-placeholder",[],function(){return function(a){return function(b){function c(){var c=b.getContent();a.container.style.display="<p><br></p>"===c||""===c?"":"none"}b.on("content-changed",c),a.container.innerHTML=a.text}}}),c("link-formatter",["scribe-common/src/element","lodash-amd/modern/collections/contains"],function(){return function(a){return function(b){function c(b){return b=b.trim(),b=e(b),a.domain&&(b=d(b,a.domain)),b}function d(a,b){var c=document.createElement("a");c.href=a;var d=c.hostname;return d.indexOf(b)>-1&&c.pathname.length>1&&(a=c.pathname+c.search+c.hash),a}function e(a){return"http://"!==a.substr(0,7)&&"https://"!==a.substr(0,8)&&"mailto:"!==a.substr(0,7)&&"/"!==a.substr(0,1)?-1!=a.indexOf("@")?"mailto:"+a:"http://"+a:a}function f(a){for(var b=a.firstElementChild;b;)"A"===b.nodeName?b.hasAttribute("href")&&b.setAttribute("href",c(b.getAttribute("href"))):b.children.length>0&&f(b),b=b.nextElementSibling}b.registerHTMLFormatter("sanitize",function(a){var b=document.createElement("div");return b.innerHTML=a,f(b),b.innerHTML})}}}),c("only-trailing-brs",[],function(){return function(){return function(a){a.registerHTMLFormatter("normalize",function(a){return a.replace(/<br>(.)/g," $1")})}}}),c("paste-strip-newlines",[],function(){return function(){return function(a){a.registerHTMLFormatter("paste",function(a){return a.replace(/\n/g," ")})}}}),c("paste-strip-nbsps",[],function(){return function(){return function(a){a.registerHTMLFormatter("paste",function(a){return a.replace(/&nbsp;/g," ")}),a.registerHTMLFormatter("normalize",function(a){return a.replace(/&nbsp;/g," ")})}}}),c("paste-from-word",["scribe-common/src/element"],function(a){return function(){return function(b){function c(a){return/<font face="Times New Roman"|class="?Mso|style="[^"]*\bmso-|style='[^'']*\bmso-|w:WordDocument/i.test(a)||/class="OutlineElement/.test(a)||/id="?docs\-internal\-guid\-/.test(a)}function d(b){for(var c=b.firstElementChild;c;){var e=c.nextElementSibling;0===c.className.indexOf("Mso")&&(c.className=null),c.hasAttribute("style")&&c.removeAttribute("style"),c.children.length>0&&d(c),"A"===c.nodeName&&(c.href||a.unwrap(b,c)),c=e}}b.registerHTMLFormatter("paste",function(a){if(!c(a))return a;a=a.replace(/<!--[\s\S]+?-->/gi,""),a=a.replace(/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|img|meta|link|style|\w:\w+)(?=[\s\/>]))[^>]*>/gi,"");var b=document.createElement("div");return b.innerHTML=a,d(b),b.innerHTML})}}}),c("paste-sanitize",["scribe-common/src/element"],function(a){return function(){return function(b){function c(b){for(var d=b.firstElementChild;d;){var e=d.nextElementSibling;d.children.length>0&&c(d),d.hasAttribute("style")&&d.removeAttribute("style"),"P"===d.nodeName&&""===d.textContent.trim()&&b.removeChild(d),"SPAN"===d.nodeName&&a.unwrap(b,d),d=e}}b.registerHTMLFormatter("paste",function(a){var b=document.createElement("div");b.innerHTML=a;var d=[].slice.call(b.childNodes);return d.forEach(function(a){3===a.nodeType&&""===a.textContent.trim()&&b.removeChild(a)}),c(b),b.innerHTML})}}}),c("remove-a-styles",["scribe-common/src/element"],function(){return function(){return function(a){function b(a){for(var c=a.firstElementChild;c;)"A"===c.nodeName&&c.hasAttribute("style")?c.removeAttribute("style"):c.children.length>0&&b(c),c=c.nextElementSibling}a.registerHTMLFormatter("sanitize",function(a){var c=document.createElement("div");return c.innerHTML=a,b(c),c.innerHTML})}}}),c("strip-bold-in-headings",["scribe-common/src/element"],function(a){return function(){return function(b){function c(b){for(var d=b.firstElementChild;d;)"B"===d.nodeName&&/^(H[1-6])$/.test(b.nodeName)?a.unwrap(b,d):d.children.length>0&&c(d),d=d.nextElementSibling}b.registerHTMLFormatter("sanitize",function(a){var b=document.createElement("div");return b.innerHTML=a,c(b),b.innerHTML})}}}),c("scribe-plugin-anchor",[],function(){return function(){return function(a){function b(a){return a.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").trim()}var c=new a.api.Command("anchor");c.queryEnabled=function(){var b=new a.api.Selection,c=b.getContaining(function(){return!0});return void 0!==c},c.queryState=function(){var b=new a.api.Selection,c=b.getContaining(function(a){return 3!==a.nodeType});return void 0===c?!1:!!c.id},c.execute=function(){var c=new a.api.Selection;console.log(c);var d=c.getContaining(function(a){return 3!==a.nodeType});console.log(d),a.transactionManager.run(function(){d.id?d.removeAttribute("id"):d.id=b(d.textContent)}.bind(this))},a.commands.toggleAnchor=c}}}),c("our-ensure-selectable-containers",["scribe-common/src/element","lodash-amd/modern/collections/contains"],function(a,b){function c(e,f){function g(b){return 0===b.children.length||1===b.children.length&&a.isSelectionMarkerNode(b.children[0])}for(var h=e.firstElementChild;h;)a.isSelectionMarkerNode(h)||(g(h)&&""===h.textContent.trim()&&!b(d,h.nodeName)&&a.isBlockElement(h)?h.appendChild(document.createElement("br")):h.children.length>0&&(f.skipElement&&f.skipElement&&f.skipElement(h)||c(h,f))),h=h.nextElementSibling}var d=["AREA","BASE","BR","COL","COMMAND","EMBED","HR","IMG","INPUT","KEYGEN","LINK","META","PARAM","SOURCE","TRACK","WBR"];return function(a){return function(b){b.registerHTMLFormatter("normalize",function(b){var d=document.createElement("div");return d.innerHTML=b,c(d,a),d.innerHTML})}}}),c("enforce-p-elements",["lodash-amd/modern/arrays/last","scribe-common/src/element"],function(a,b){function c(c){var d=Array.prototype.reduce.call(c.childNodes,function(c,d){function e(){var a=[d];c.push(a)}var f=a(c);if(f){var g=b.isBlockElement(f[0]);g===b.isBlockElement(d)?f.push(d):e()}else e();return c},[]),e=d.filter(function(a){var c=b.isBlockElement(a[0]);return!c});e.forEach(function(a){var b=document.createElement("p");a[0].parentNode.insertBefore(b,a[0]),a.forEach(function(a){b.appendChild(a)})}),c._isWrapped=!0}function d(a){for(var b=document.createTreeWalker(a,NodeFilter.SHOW_ELEMENT),e=b.firstChild();e;){if("BLOCKQUOTE"===e.nodeName&&!e._isWrapped){c(e),d(a);break}e=b.nextSibling()}}return function(){return function(a){a.registerHTMLFormatter("normalize",function(a){var b=document.createElement("div");return b.innerHTML=a,c(b),d(b),b.innerHTML})}}}),c("onion-editor",["scribe","scribe-plugin-blockquote-command","scribe-plugin-curly-quotes","scribe-plugin-formatter-plain-text-convert-new-lines-to-html","scribe-plugin-heading-command","scribe-plugin-intelligent-unlink-command","scribe-plugin-keyboard-shortcuts","scribe-plugin-link-ui","scribe-plugin-sanitizer","scribe-plugin-smart-lists","scribe-plugin-toolbar","scribe-plugin-inline-objects","scribe-plugin-betty-cropper","scribe-plugin-youtube","scribe-plugin-embed","scribe-plugin-onion-video","scribe-plugin-hr","scribe-plugin-placeholder","link-formatter","only-trailing-brs","paste-strip-newlines","paste-strip-nbsps","paste-from-word","paste-sanitize","remove-a-styles","strip-bold-in-headings","scribe-plugin-anchor","our-ensure-selectable-containers","enforce-p-elements"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C){function D(t,D){function F(a){return $(a).is("div.inline")}D=$.extend(E,D),$(".inline",t).attr("contenteditable","false");var G=new a(t,{allowBlockElements:D.multiline});G._htmlFormatterFactory.formatters.normalize=[],G.allowsBlockElements()&&(G.use(C()),G.use(B({skipElement:F})));var H=new G.api.CommandPatch("insertHTML");H.execute=function(a){G.transactionManager.run(function(){function b(a){var c=document.createTreeWalker(a,NodeFilter.SHOW_ELEMENT),d=c.firstChild();if(d)do"SPAN"===d.nodeName&&-1===d.className.indexOf("inline")?t.unwrap(a,d):(d.style.lineHeight=null,""===d.getAttribute("style")&&d.removeAttribute("style")),b(d);while(d=c.nextSibling())}G.api.CommandPatch.prototype.execute.call(this,a),b(G.el)}.bind(this))},G.commandPatches.insertHTML=H,D.placeholder&&G.use(r(D.placeholder));var I=new G.api.CommandPatch("bold");I.execute=function(a){void 0===this.selection?document.execCommand(this.commandName,!1,a||null):G.transactionManager.run(function(){document.execCommand(this.commandName,!1,a||null)}.bind(this))},G.commandPatches.bold=I;var J=new G.api.CommandPatch("italic");J.execute=function(a){void 0===this.selection?document.execCommand(this.commandName,!1,a||null):G.transactionManager.run(function(){document.execCommand(this.commandName,!1,a||null)}.bind(this))},G.commandPatches.italic=J;var K=new G.api.CommandPatch("underline");K.execute=function(a){void 0===this.selection?document.execCommand(this.commandName,!1,a||null):G.transactionManager.run(function(){document.execCommand(this.commandName,!1,a||null)}.bind(this))},G.commandPatches.underline=K;var L={},M=function(a){return a.metaKey||a.ctrlKey},N={};return D.multiline&&(N.p={id:!0},N.br={},N.hr={}),-1!==D.formatting.indexOf("bold")&&(L.bold=function(a){return a.metaKey&&66===a.keyCode},N.b={id:!0}),-1!==D.formatting.indexOf("italic")&&(L.italic=function(a){return a.metaKey&&73===a.keyCode},N.i={id:!0},N.em={id:!0}),-1!==D.formatting.indexOf("strike")&&(L.strikeThrough=function(a){return a.altKey&&a.shiftKey&&83===a.keyCode},N.s={id:!0}),-1!==D.formatting.indexOf("underline")&&(L.underline=function(a){return a.metaKey&&85===a.keyCode},N.u={id:!0}),L.removeFormat=function(a){return a.altKey&&a.shiftKey&&65===a.keyCode},D.multiline&&-1!==D.formatting.indexOf("link")&&(L.linkUI=function(a){return a.metaKey&&!a.shiftKey&&75===a.keyCode},L.unlink=function(a){return a.metaKey&&a.shiftKey&&75===a.keyCode},G.use(f()),G.use(h(D.link)),G.use(s(D.link)),N.a={href:!0,target:!0,id:!0}),D.multiline&&-1!==D.formatting.indexOf("list")&&(L.insertUnorderedList=function(a){return a.altKey&&a.shiftKey&&66===a.keyCode},L.insertOrderedList=function(a){return a.altKey&&a.shiftKey&&78===a.keyCode},G.use(j()),N.ol={id:!0},N.ul={id:!0},N.li={id:!0}),D.multiline&&-1!==D.formatting.indexOf("blockquote")&&(L.blockquote=function(a){return a.altKey&&a.shiftKey&&87===a.keyCode},G.use(b()),N.blockquote={id:!0}),D.multiline&&-1!==D.formatting.indexOf("heading")&&(L.h3=function(a){return M(a)&&50===a.keyCode},L.h4=function(a){return M(a)&&51===a.keyCode},G.use(e(3)),G.use(e(4)),N.h3={id:!0},N.h4={id:!0}),D.multiline&&D.inlineObjects&&(G.use(l(D.inlineObjects)),G.use(m(D.image)),G.use(n()),G.use(o()),G.use(q()),G.use(A()),G.use(p(D.video)),G.use(y()),G.use(z())),G.use(i({tags:N,skipSanitization:F})),G.use(w()),G.use(x()),G.use(u()),G.use(v()),D.statsContainer&&setInterval(function(){$(D.statsContainer).html($(G.el).text().split(" ").length)},3e3),G.updateContents=function(a,b){"undefined"==typeof b&&(b=!0),G._skipFormatters=b;var c=window.scrollY;setTimeout(function(){G.el.focus(),setTimeout(function(){G.transactionManager.run(a),window.scrollTo(0,c),G.trigger("content-changed")},20)},20)},G.use(c()),G.use(g(Object.freeze(L))),D.multiline?G.use(k($(".document-tools .toolbar-contents",t.parentNode)[0])):$(".document-tools .toolbar-contents",t.parentNode).hide(),G.el.addEventListener("keydown",function(a){if(8===a.keyCode){var b=new G.api.Selection,c=$(b.selection.anchorNode).closest(".editor>*").prev();c.hasClass("inline")&&0===b.selection.anchorOffset&&b.selection.isCollapsed&&a.preventDefault()}}),G.use(d()),this.setChangeHandler=function(a){G.on("content-changed",a)},this.setContent=function(a){a||(a="<p><br></p>"),G.setContent(a)},this.getContent=function(){var a=G.getContent();return a},this.scribe=G,this}var E={multiline:!0,formatting:["link","bold","italic","blockquote","heading","list","underline"],link:{domain:"avclub.com"},video:{videoEmbedUrl:"http://example.com?videoid=",insertDialog:function(){},editDialog:function(){}},image:{insertDialog:function(){},editDialog:function(){}}};return D}),b("onion-editor")});